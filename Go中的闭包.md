# Goä¸­çš„é—­åŒ…

åœ¨ Go è¯­è¨€ä¸­ï¼Œ**é—­åŒ…ï¼ˆClosureï¼‰** æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”å¸¸ç”¨çš„è¯­è¨€ç‰¹æ€§ã€‚å®ƒæŒ‡çš„æ˜¯ï¼š**å‡½æ•°å¯ä»¥è®¿é—®å¹¶æ“ä½œå…¶å®šä¹‰æ—¶æ‰€å¤„çš„è¯æ³•ä½œç”¨åŸŸä¸­çš„å˜é‡ï¼Œå³ä½¿è¯¥å‡½æ•°åœ¨å…¶å¤–éƒ¨è¢«è°ƒç”¨ã€‚**

---

## ğŸ“Œ ä¸€ã€ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ

ç®€å•æ¥è¯´ï¼š

> **é—­åŒ… = å‡½æ•° + å¼•ç”¨ç¯å¢ƒ**

Go æ”¯æŒåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”è¿™äº›åŒ¿åå‡½æ•°å¯ä»¥è®¿é—®å…¶å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ï¼Œè¿™å°±æ„æˆäº†é—­åŒ…ã€‚

---

## ğŸ§ª äºŒã€é—­åŒ…ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šåŸºæœ¬é—­åŒ…

```go
func outer() func() {
    x := 10
    return func() {
        fmt.Println(x)
    }
}

func main() {
    f := outer()
    f() // è¾“å‡º 10
}
```

- `outer` è¿”å›äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚
- è¿™ä¸ªåŒ¿åå‡½æ•°â€œæ•è·â€äº†å˜é‡ `x`ï¼Œå³ä½¿ `outer` å·²ç»è¿”å›ï¼Œ`x` ä¾ç„¶å­˜åœ¨ã€‚
- è¿™å°±æ˜¯é—­åŒ…çš„è¡Œä¸ºã€‚

---

### ç¤ºä¾‹ 2ï¼šå¤šä¸ªé—­åŒ…å…±äº«å˜é‡

```go
func counter() (func(), func()) {
    count := 0
    inc := func() {
        count++
        fmt.Println("Increment:", count)
    }
    dec := func() {
        count--
        fmt.Println("Decrement:", count)
    }
    return inc, dec
}

func main() {
    a, b := counter()
    a() // Increment: 1
    a() // Increment: 2
    b() // Decrement: 1
}
```

- `inc` å’Œ `dec` éƒ½å¼•ç”¨äº†åŒä¸€ä¸ª `count` å˜é‡ã€‚
- å®ƒä»¬å…±äº«è¿™ä¸ªå˜é‡çš„çŠ¶æ€ â€”â€” è¿™ä¹Ÿæ˜¯é—­åŒ…çš„å…¸å‹ç‰¹å¾ã€‚

---

## ğŸ” ä¸‰ã€é—­åŒ…ä¸å¾ªç¯å˜é‡é™·é˜± âš ï¸

è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„è¯¯åŒºï¼

### é”™è¯¯å†™æ³•ï¼š

```go
funcs := make([]func(), 3)

for i := 0; i < 3; i++ {
    funcs[i] = func() {
        fmt.Println(i)
    }
}

for _, f := range funcs {
    f()
}
```

è¾“å‡ºå¯èƒ½æ˜¯ï¼š

```
3
3
3
```

### åŸå› ï¼š

æ‰€æœ‰é—­åŒ…éƒ½**å¼•ç”¨äº†åŒä¸€ä¸ªå˜é‡ `i`**ï¼Œè€Œä¸æ˜¯å¤åˆ¶å®ƒçš„å€¼ã€‚å½“é—­åŒ…æ‰§è¡Œæ—¶ï¼Œå¾ªç¯å·²ç»ç»“æŸï¼Œ`i` çš„å€¼å·²ç»æ˜¯ 3ã€‚

---

### æ­£ç¡®åšæ³•ï¼š

#### æ–¹æ³• 1ï¼šå°†å˜é‡ä½œä¸ºå‚æ•°ä¼ å…¥é—­åŒ…

```go
for i := 0; i < 3; i++ {
    funcs[i] = func(i int) {
        fmt.Println(i)
    }
}
```

æˆ–è€…ï¼š

```go
for i := 0; i < 3; i++ {
    v := i
    funcs[i] = func() {
        fmt.Println(v)
    }
}
```

è¿™æ ·æ¯ä¸ªé—­åŒ…å°±æ‹¥æœ‰äº†è‡ªå·±çš„å‰¯æœ¬ã€‚

---

## âœ… å››ã€é—­åŒ…çš„ä½œç”¨åœºæ™¯

é—­åŒ…åœ¨ Go ä¸­éå¸¸å®ç”¨ï¼Œå¸¸è§ç”¨é€”åŒ…æ‹¬ï¼š

| åœºæ™¯     | æè¿°                                              |
| -------- | ------------------------------------------------- |
| å°è£…çŠ¶æ€ | å®ç°ç±»ä¼¼â€œå¯¹è±¡â€çš„è¡Œä¸ºï¼Œæ¯”å¦‚è®¡æ•°å™¨ã€ç¼“å­˜ç­‰          |
| å»¶è¿Ÿè®¡ç®— | ç»“åˆ `defer` ä½¿ç”¨ï¼Œå»¶è¿Ÿæ‰§è¡ŒæŸäº›é€»è¾‘               |
| å‡½æ•°å·¥å‚ | åŠ¨æ€ç”Ÿæˆå‡½æ•°ï¼Œä¾‹å¦‚æ ¹æ®å‚æ•°ç”Ÿæˆä¸åŒåŠŸèƒ½çš„å‡½æ•°      |
| å¹¶å‘å®‰å…¨ | æ­é… `sync.WaitGroup` æˆ– `goroutine` å®ç°å¹¶å‘æ§åˆ¶ |
| è·¯ç”±å¤„ç† | åœ¨ Web æ¡†æ¶ä¸­ç”¨äºæ³¨å†Œä¸­é—´ä»¶æˆ–è·¯ç”±å¤„ç†å‡½æ•°         |

---

## ğŸ§  äº”ã€é—­åŒ…çš„æ€§èƒ½é—®é¢˜

é—­åŒ…ä¼šæŒæœ‰å¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´ï¼š

- **å†…å­˜æ³„æ¼é£é™©**ï¼šå¦‚æœé—­åŒ…é•¿æ—¶é—´å­˜æ´»ï¼Œä¼šå¯¼è‡´å…¶å¼•ç”¨çš„å˜é‡æ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚
- **æ„å¤–å‰¯ä½œç”¨**ï¼šå¤šä¸ªé—­åŒ…å…±äº«å˜é‡æ—¶ï¼Œå¯èƒ½å¼•å‘å¹¶å‘ä¿®æ”¹é”™è¯¯ã€‚

å»ºè®®ï¼š
- æ˜ç¡®å˜é‡ç”Ÿå‘½å‘¨æœŸã€‚
- å¯¹äºå¤§ç»“æ„ä½“æˆ–é¢‘ç¹ä½¿ç”¨çš„èµ„æºï¼Œå°½é‡ä½¿ç”¨æŒ‡é’ˆé¿å…æ‹·è´ã€‚
- æ³¨æ„å¹¶å‘å®‰å…¨é—®é¢˜ï¼ˆå¦‚ä½¿ç”¨é”ï¼‰ã€‚

---

## ğŸ“š å…­ã€æ€»ç»“

| ç‰¹æ€§           | è¯´æ˜                                         |
| -------------- | -------------------------------------------- |
| é—­åŒ…æœ¬è´¨       | å‡½æ•° + å¤–éƒ¨å˜é‡å¼•ç”¨                          |
| æ˜¯å¦æŒæœ‰å˜é‡   | æ˜¯ï¼Œç›´åˆ°é—­åŒ…ä¸å†è¢«å¼•ç”¨                       |
| æ˜¯å¦ä¼šå‘ç”Ÿæ‹·è´ | ä¸ä¼šè‡ªåŠ¨æ‹·è´ï¼Œä½†ä½ å¯ä»¥æ‰‹åŠ¨æ‹·è´æ¥é¿å…å…±äº«é—®é¢˜ |
| æ˜¯å¦é€‚ç”¨äºå¹¶å‘ | æ˜¯ï¼Œä½†è¦æ³¨æ„åŒæ­¥å’Œç«æ€æ¡ä»¶                   |

