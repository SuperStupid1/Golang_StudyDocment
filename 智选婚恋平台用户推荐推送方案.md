# æ™ºé€‰å©šæ‹å¹³å°ç”¨æˆ·æ¨èæ¨é€æ–¹æ¡ˆ

---

# ğŸ§  é¡¹ç›®æ€»ç»“ï¼šæ™ºé€‰å©šæ‹å¹³å°ç”¨æˆ·åŒ¹é…æ¨èæ¨é€ç³»ç»Ÿ

---

## ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡

### âœ… èƒŒæ™¯ï¼š
- é¢å‘å©šæ‹å¹³å°ä¼šå‘˜ç”¨æˆ·æä¾›æ¯æ—¥15ä¸ªç›¸äº²å¯¹è±¡çš„ä¸ªæ€§åŒ–æ¨èã€‚
- åˆæœŸç”¨æˆ·æ± è¾ƒå°ï¼Œéœ€å…¼é¡¾**ç²¾å‡†åŒ¹é…**ä¸**æ¨é€æ•°é‡ä¿éšœ**ã€‚

### ğŸ¯ æ ¸å¿ƒç›®æ ‡ï¼š
- **æ ¹æ®ç”¨æˆ·çš„æ‹©å¶è¦æ±‚å’Œè¡Œä¸ºæ•°æ®**ï¼Œæ¨èç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ã€‚
- **æå‡åŒ¹é…è´¨é‡ä¸ç”¨æˆ·ä½“éªŒ**ï¼ŒåŒæ—¶ä¿è¯æ¯å¤©æœ‰è¶³å¤Ÿæ•°é‡çš„æ¨é€ã€‚
- **æ”¯æŒæœªæ¥æ‰©å±•**ï¼Œå¦‚å¼•å…¥æœºå™¨å­¦ä¹ æ¨¡å‹ä¼˜åŒ–æ¨èæ•ˆæœã€‚

---

## äºŒã€æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ

| æ¨¡å—         | åŠŸèƒ½                                  |
| ------------ | ------------------------------------- |
| ç”¨æˆ·ç”»åƒæ„å»º | æ”¶é›†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€æ‹©å¶è¦æ±‚ã€è¡Œä¸ºæ•°æ®  |
| å€™é€‰æ± ç­›é€‰   | ç­›é€‰å‡ºç¬¦åˆåŸºç¡€æ¡ä»¶çš„æ½œåœ¨åŒ¹é…å¯¹è±¡      |
| åŒ¹é…åº¦è®¡ç®—   | å¤šç»´åº¦åŠ æƒè¯„åˆ†ï¼ˆåŸºæœ¬+è¡Œä¸º+åœ°ç†ä½ç½®ï¼‰  |
| æ¨é€ç­–ç•¥æ§åˆ¶ | æ§åˆ¶å¤šæ ·æ€§ã€é¿å…é‡å¤ã€æ–°ç”¨æˆ·ä¼˜å…ˆ      |
| åŠ¨æ€æ”¾å®½æœºåˆ¶ | æ¡ä»¶åˆ†å±‚ + åŠ¨æ€è°ƒæ•´ï¼Œåº”å¯¹å°ç”¨æˆ·æ± é—®é¢˜ |
| ä¿åº•æœºåˆ¶     | åœ¨åŒ¹é…ä¸è¶³æ—¶è¡¥å……é«˜è´¨é‡/æ´»è·ƒç”¨æˆ·       |
| åç»­ä¼˜åŒ–æ–¹å‘ | å¼•å…¥åé¦ˆæœºåˆ¶ã€æœºå™¨å­¦ä¹ ã€A/Bæµ‹è¯•       |

---

## ä¸‰ã€å…³é”®å®ç°æµç¨‹

```
[1] ç”¨æˆ·æ³¨å†Œå¹¶å¡«å†™æ‹©å¶ä¿¡æ¯
           â†“
[2] æ„å»ºç”¨æˆ·ç”»åƒï¼ˆå«ç¡¬æ€§/è½¯æ€§æ¡ä»¶ï¼‰
           â†“
[3] å€™é€‰æ± ç­›é€‰ â†’ åˆ†å±‚è¿‡æ»¤ï¼ˆæ ¸å¿ƒæ¡ä»¶ â†’ éæ ¸å¿ƒæ¡ä»¶ï¼‰
           â†“
[4] åŒ¹é…åº¦è®¡ç®— â†’ å¤šç»´åº¦åŠ æƒè¯„åˆ†ï¼ˆ0.5 + 0.3 + 0.15 + 0.05ï¼‰
           â†“
[5] æ¨é€åˆ—è¡¨ç”Ÿæˆ â†’ æ§åˆ¶å¤šæ ·æ€§ + å»é‡ + æ–°ç”¨æˆ·ä¼˜å…ˆ
           â†“
[6] åŠ¨æ€æ”¾å®½æ¡ä»¶ â†’ å¦‚æœç»“æœä¸è¶³ï¼Œé€æ­¥æ”¾å®½éæ ¸å¿ƒæ¡ä»¶
           â†“
[7] ä¿åº•æ¨é€æœºåˆ¶ â†’ è¡¥å……æ´»è·ƒç”¨æˆ·ã€æ–°ç”¨æˆ·ã€é«˜è´¨é‡ç”¨æˆ·
           â†“
[8] æ¨é€å±•ç¤º + ç”¨æˆ·åé¦ˆæ”¶é›† â†’ åé¦ˆç”¨äºåç»­æ¨¡å‹è®­ç»ƒ
```

---

## å››ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£

### ğŸ”¹ 1. ç”¨æˆ·ç”»åƒæ„å»º

| æ•°æ®ç±»å‹ | å†…å®¹ç¤ºä¾‹                                   |
| -------- | ------------------------------------------ |
| åŸºæœ¬ä¿¡æ¯ | å¹´é¾„ã€æ€§åˆ«ã€èº«é«˜ã€å­¦å†ã€èŒä¸šã€æ”¶å…¥ã€æˆ¿äº§ç­‰ |
| æ‹©å¶è¦æ±‚ | å¹´é¾„èŒƒå›´ã€èº«é«˜èŒƒå›´ã€å­¦å†è¦æ±‚ã€æ”¶å…¥æœŸæœ›ç­‰   |
| è¡Œä¸ºæ•°æ® | æµè§ˆè®°å½•ã€ç‚¹èµè®°å½•ã€èŠå¤©è®°å½•ã€æ”¶è—ç­‰       |

> âš ï¸ æç¤ºï¼šè¡Œä¸ºæ•°æ®å¯ç”¨äºæ„å»ºåå¥½æ¨¡å‹ï¼Œå¢å¼ºæ¨èä¸ªæ€§åŒ–ã€‚

---

### ğŸ”¹ 2. å€™é€‰æ± ç­›é€‰ç­–ç•¥

#### åˆ†å±‚ç­›é€‰æœºåˆ¶ï¼š

1. **ç¬¬ä¸€å±‚ï¼šæ ¸å¿ƒæ¡ä»¶åŒ¹é…**
   - å¹´é¾„ã€èº«é«˜ã€å­¦å†ç­‰å¿…é¡»æ»¡è¶³çš„æ¡ä»¶
2. **ç¬¬äºŒå±‚ï¼šéæ ¸å¿ƒæ¡ä»¶æ”¾å®½**
   - æ”¶å…¥ã€æˆ¿äº§ã€è·ç¦»ç­‰å¯é€‚å½“æ”¾å®½çš„æ¡ä»¶
3. **ç¬¬ä¸‰å±‚ï¼šåŠ¨æ€æ”¾å®½ç­–ç•¥**
   - å¦‚å¹´é¾„Â±2å²ã€å­¦å†ä»æœ¬ç§‘â†’å¤§ä¸“ã€æ”¶å…¥ä»10kâ†’8kç­‰

#### ç¤ºä¾‹é€»è¾‘ï¼š

```text
if count >= 15:
    return top 15
elif count < 15:
    æ”¾å®½æ”¶å…¥ã€è·ç¦»ç­‰éæ ¸å¿ƒæ¡ä»¶
elif count == 0:
    å¯ç”¨ä¿åº•æœºåˆ¶ï¼ˆéšæœº+æ´»è·ƒ+æ–°ç”¨æˆ·ï¼‰
```

---

### ğŸ”¹ 3. åŒ¹é…åº¦è¯„åˆ†ç®—æ³•

#### ç»´åº¦åŠæƒé‡åˆ†é…å»ºè®®ï¼š

| ç»´åº¦         | æƒé‡ | è¯´æ˜                               |
| ------------ | ---- | ---------------------------------- |
| æ‹©å¶è¦æ±‚åŒ¹é… | 50%  | æ˜¯å¦å®Œå…¨ç¬¦åˆç”¨æˆ·è®¾å®šçš„ç†æƒ³å¯¹è±¡æ¡ä»¶ |
| åŸºæœ¬ä¿¡æ¯åŒ¹é… | 30%  | å¹´é¾„ã€èº«é«˜ã€å­¦å†ç­‰æ˜¯å¦æ¥è¿‘         |
| è¡Œä¸ºæ•°æ®åŒ¹é… | 15%  | æ˜¯å¦æµè§ˆã€ç‚¹èµè¿‡ç±»ä¼¼ç”¨æˆ·           |
| åœ°ç†ä½ç½®åŒ¹é… | 5%   | æ˜¯å¦åœ¨åŒåŸæˆ–é™„è¿‘åŸå¸‚               |

#### ç¤ºä¾‹å…¬å¼ï¼š

```go
score = reqMatch*0.5 + baseMatch*0.3 + behaviorMatch*0.15 + locationMatch*0.05
```

---

### ğŸ”¹ 4. æ¨é€ç­–ç•¥ä¼˜åŒ–

#### âœ… æ¨é€è§„åˆ™è®¾è®¡ï¼š

| è§„åˆ™       | æè¿°                           |
| ---------- | ------------------------------ |
| æ¯æ—¥é™åˆ¶   | æ¯å¤©æœ€å¤šæ¨é€15äºº               |
| å»é‡æœºåˆ¶   | è¿‘7å¤©å†…å·²æ¨é€è¿‡çš„ä¸å†é‡å¤å‡ºç°  |
| å¤šæ ·æ€§æ§åˆ¶ | ä¿è¯èŒä¸šã€åœ°åŒºã€æ”¶å…¥åˆ†å¸ƒå¤šæ ·åŒ– |
| æ–°ç”¨æˆ·ä¼˜å…ˆ | æé«˜æ–°æ³¨å†Œç”¨æˆ·çš„æ›å…‰ç‡         |

---

### ğŸ”¹ 5. åŠ¨æ€æ”¾å®½æœºåˆ¶ï¼ˆåº”å¯¹å°ç”¨æˆ·æ± ï¼‰

#### å®ç°æ–¹å¼ï¼š

- å°†æ‹©å¶æ¡ä»¶åˆ†ä¸ºâ€œ**å¿…é¡»æ»¡è¶³**â€å’Œâ€œ**å¯æ”¾å®½**â€ä¸¤ç±»
- è‹¥åˆæ­¥ç­›é€‰äººæ•°ä¸è¶³ï¼Œåˆ™é€æ­¥æ”¾å®½â€œå¯æ”¾å®½â€æ¡ä»¶

#### ç¤ºä¾‹æ”¾å®½é¡ºåºï¼š

```text
1. æ”¶å…¥é™ä½ â†’ 2. åœ°ç†èŒƒå›´æ‰©å¤§ â†’ 3. å­¦å†é™ä½ â†’ 4. å¹´é¾„æ”¾å®½
```

---

### ğŸ”¹ 6. ä¿åº•æ¨é€æœºåˆ¶

å½“æ‰€æœ‰æ¡ä»¶éƒ½æ”¾å®½åä»æ— æ³•æ»¡è¶³æ¨é€æ•°é‡æ—¶ï¼Œå¯ç”¨ä¿åº•æœºåˆ¶ï¼š

| ç±»å‹       | æè¿°                               |
| ---------- | ---------------------------------- |
| æ´»è·ƒç”¨æˆ·   | æœ€è¿‘æœ‰ç™»å½•ã€äº’åŠ¨è¡Œä¸ºçš„ç”¨æˆ·         |
| æ–°ç”¨æˆ·     | æ³¨å†Œæ—¶é—´è¾ƒçŸ­çš„ç”¨æˆ·ï¼Œæé«˜æ›å…‰ç‡     |
| é«˜è´¨é‡ç”¨æˆ· | å®Œå–„èµ„æ–™ã€å®åè®¤è¯ã€ç…§ç‰‡è¾ƒå¤šçš„ç”¨æˆ· |
| éšæœºç”¨æˆ·   | ä»å€™é€‰æ± ä¸­éšæœºé€‰å–ï¼Œç¡®ä¿æ¨é€ä¸ä¸ºç©º |

---

### ğŸ”¹ 7. ç”¨æˆ·æç¤ºä¸å¼•å¯¼æœºåˆ¶

| åŠŸèƒ½     | æè¿°                               |
| -------- | ---------------------------------- |
| æç¤ºè¯­   | â€œå½“å‰åŒ¹é…è¾ƒå°‘ï¼Œå·²ä¸ºæ‚¨æ”¾å®½éƒ¨åˆ†æ¡ä»¶â€ |
| ä¸€é”®æ”¾å®½ | æä¾›æŒ‰é’®è®©ç”¨æˆ·å¿«é€Ÿè°ƒæ•´ç­›é€‰æ¡ä»¶     |
| ç”¨æˆ·åé¦ˆ | æ”¯æŒâ€œå–œæ¬¢â€æˆ–â€œä¸å–œæ¬¢â€ï¼Œç”¨äºæ¨¡å‹è¿­ä»£ |

---

## äº”ã€ç³»ç»Ÿæ¶æ„ä¸æ€§èƒ½ä¼˜åŒ–

### ğŸ“¦ æŠ€æœ¯æ ˆå»ºè®®ï¼š

| æ¨¡å—         | æŠ€æœ¯é€‰å‹                                   |
| ------------ | ------------------------------------------ |
| ç”¨æˆ·æ•°æ®å­˜å‚¨ | MySQL / PostgreSQL                         |
| è¡Œä¸ºæ•°æ®     | Kafka + Hadoop / Spark / Flink             |
| ç¼“å­˜æœºåˆ¶     | Redisï¼ˆç¼“å­˜åŒ¹é…åº¦è¯„åˆ†ã€æ¨é€åˆ—è¡¨ï¼‰          |
| æ¨é€ä»»åŠ¡è°ƒåº¦ | Cron Job / Airflow / Quartz                |
| åˆ†å¸ƒå¼å¤„ç†   | Spark / MapReduceï¼ˆå¤§æ•°æ®åœºæ™¯ï¼‰            |
| æ¨èæ¨¡å‹     | Python Scikit-learn / TensorFlow / PyTorch |

---

### ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š

| ä¼˜åŒ–é¡¹     | æè¿°                              |
| ---------- | --------------------------------- |
| ç¼“å­˜æœºåˆ¶   | é¢„å…ˆè®¡ç®—åŒ¹é…åº¦è¯„åˆ†å¹¶ç¼“å­˜          |
| åˆ†å¸ƒå¼è®¡ç®— | ä½¿ç”¨ Spark æ‰¹é‡è®¡ç®—å¤§è§„æ¨¡ç”¨æˆ·åŒ¹é… |
| å®æ—¶æ›´æ–°   | ç”¨æˆ·ä¿®æ”¹æ‹©å¶è¦æ±‚åè§¦å‘é‡æ–°è®¡ç®—    |
| A/Bæµ‹è¯•    | å¯¹ä¸åŒç®—æ³•ç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”æµ‹è¯•        |

---

## å…­ã€åç»­ä¼˜åŒ–æ–¹å‘

| æ–¹å‘         | æè¿°                                 |
| ------------ | ------------------------------------ |
| ç”¨æˆ·åé¦ˆé—­ç¯ | æ”¶é›†ç”¨æˆ·å¯¹æ¨é€çš„åé¦ˆï¼ŒæŒç»­ä¼˜åŒ–æ¨¡å‹   |
| æ¨èæ¨¡å‹å‡çº§ | å¼•å…¥ååŒè¿‡æ»¤ã€æ·±åº¦å­¦ä¹ æ¨¡å‹æå‡å‡†ç¡®ç‡ |
| å†·å¯åŠ¨ç­–ç•¥   | å¯¹æ–°ç”¨æˆ·é‡‡ç”¨çƒ­é—¨æ¨èã€éšæœºæ¨èç­‰æ–¹å¼ |
| å®æ—¶æ¨è     | ç»“åˆå®æ—¶è¡Œä¸ºæµæ•°æ®åšæ›´æ™ºèƒ½çš„æ¨è     |

---

## ä¸ƒã€é€‚ç”¨åœºæ™¯æ‹“å±•

è¯¥æ¨èç³»ç»Ÿä¸ä»…é€‚ç”¨äºå©šæ‹å¹³å°ï¼Œä¹Ÿå¯æ¨å¹¿åˆ°ä»¥ä¸‹é¢†åŸŸï¼š

| åº”ç”¨åœºæ™¯ | é€‚é…æ–¹å¼                     |
| -------- | ---------------------------- |
| ç¤¾äº¤äº¤å‹ | ç›¸ä¼¼å…´è¶£æ ‡ç­¾åŒ¹é…             |
| èŒåœºç¤¾äº¤ | èŒä¸šã€æŠ€èƒ½ã€ç»éªŒåŒ¹é…         |
| ç”µå•†æ¨è | å•†å“åå¥½ã€å†å²è´­ä¹°è¡Œä¸ºåˆ†æ   |
| æ¸¸æˆåŒ¹é… | ç©å®¶ç­‰çº§ã€æ®µä½ã€æ¸¸æˆé£æ ¼åŒ¹é… |

---

## å…«ã€æ€»ç»“ä¸€å¥è¯

> **è¯¥é¡¹ç›®é€šè¿‡â€œå¤šç»´åº¦è¯„åˆ† + åˆ†å±‚ç­›é€‰ + åŠ¨æ€æ”¾å®½ + ä¿åº•æœºåˆ¶â€çš„ç»„åˆç­–ç•¥ï¼Œå®ç°äº†åœ¨ç”¨æˆ·æ± è¾ƒå°çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æä¾›ç²¾å‡†ä¸”å¤šæ ·åŒ–çš„æ¨èæœåŠ¡ï¼Œå…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå·¥ç¨‹è½åœ°èƒ½åŠ›ã€‚**

---





---

# ğŸ§± Go å®ç°ï¼šå©šæ‹å¹³å°ç”¨æˆ·æ¨èæ¨é€ç³»ç»Ÿ

**Go è¯­è¨€å®ç°çš„å©šæ‹å¹³å°ç”¨æˆ·æ¨èæ¨é€ç³»ç»Ÿæ¨¡æ¿**ï¼Œæ¶µç›–ï¼š

- ç”¨æˆ·ç”»åƒç»“æ„ä½“
- æ¨é€åŒ¹é…ç®—æ³•é€»è¾‘ï¼ˆå¤šç»´åº¦è¯„åˆ†ï¼‰
- åŠ¨æ€æ”¾å®½æ¡ä»¶ç­–ç•¥
- ä¿åº•æœºåˆ¶
- Redis ç¼“å­˜å»é‡ä¸ç¼“å­˜æ¨é€åˆ—è¡¨

---

## ä¸€ã€æ•°æ®ç»“æ„å®šä¹‰

### ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ä¸æ‹©å¶è¦æ±‚

```go
type User struct {
	ID           string   `json:"id"`
	Gender       string   `json:"gender"`     // æ€§åˆ«
	Age          int      `json:"age"`        // å¹´é¾„
	Height       int      `json:"height"`     // èº«é«˜
	Education    string   `json:"education"`  // å­¦å†
	Income       float64  `json:"income"`     // æ”¶å…¥
	City         string   `json:"city"`       // åŸå¸‚
	IsNewUser    bool     `json:"is_new"`     // æ˜¯å¦ä¸ºæ–°ç”¨æˆ·
	HasVerified  bool     `json:"has_verified"` // æ˜¯å¦å®åè®¤è¯
	Preferences  Preferences `json:"preferences"` // æ‹©å¶è¦æ±‚
	BrowsingHist []string `json:"browsing_hist"` // æµè§ˆå†å²
}

type Preferences struct {
	MinAge        int      `json:"min_age"`         // æœ€å°å¹´é¾„
	MaxAge        int      `json:"max_age"`         // æœ€å¤§å¹´é¾„
	MinHeight     int      `json:"min_height"`      // æœ€ä½èº«é«˜
	PreferredEdu  []string `json:"preferred_edu"`   // ç†æƒ³å­¦å†
	MinIncome     float64  `json:"min_income"`      // æœ€ä½æ”¶å…¥
	LocationRange int      `json:"location_range"`  // åœ°ç†èŒƒå›´ï¼ˆå…¬é‡Œï¼‰
}
```

---

## äºŒã€æ ¸å¿ƒæ¨èé€»è¾‘

### åŒ¹é…åº¦è¯„åˆ†å‡½æ•°

```go
func calculateMatchScore(target, user User) float64 {
	var score float64

	// æ‹©å¶è¦æ±‚åŒ¹é…ï¼ˆ50%ï¼‰
	reqScore := calculateRequirementScore(target, user)
	score += reqScore * 0.5

	// åŸºæœ¬ä¿¡æ¯åŒ¹é…ï¼ˆ30%ï¼‰
	baseScore := calculateBasicInfoScore(target, user)
	score += baseScore * 0.3

	// è¡Œä¸ºæ•°æ®åŒ¹é…ï¼ˆ15%ï¼‰
	behaviorScore := calculateBehaviorMatch(target, user)
	score += behaviorScore * 0.15

	// åœ°ç†ä½ç½®åŒ¹é…ï¼ˆ5%ï¼‰
	locationScore := calculateLocationMatch(target, user)
	score += locationScore * 0.05

	return score
}

func calculateRequirementScore(target, user User) float64 {
	if user.Age < target.Preferences.MinAge || user.Age > target.Preferences.MaxAge {
		return 0
	}
	if user.Height < target.Preferences.MinHeight {
		return 0
	}
	if !containsString(target.Preferences.PreferredEdu, user.Education) {
		return 0
	}
	if user.Income < target.Preferences.MinIncome {
		return 0
	}
	return 1.0
}

func calculateBasicInfoScore(target, user User) float64 {
	// å¯æ ¹æ®å¹´é¾„å·®ã€å­¦å†é«˜ä½ç­‰è®¡ç®—ç›¸ä¼¼åº¦
	ageDiff := abs(target.Age - user.Age)
	heightDiff := abs(target.Height - user.Height)

	// ç®€åŒ–å¤„ç†ï¼šå¹´é¾„å·®å°äº5å²å¾—æ»¡åˆ†ï¼Œæ¯å¢åŠ æ‰£åˆ†
	score := 1.0 - math.Min(float64(ageDiff)/10, 0.8)
	score -= math.Min(float64(heightDiff)/10, 0.2)
	return clamp(score, 0, 1)
}

func calculateBehaviorMatch(target, user User) float64 {
	// å¦‚æœæµè§ˆè¿‡è¯¥ç”¨æˆ·ï¼ŒåŠ åˆ†
	for _, hist := range target.BrowsingHist {
		if hist == user.ID {
			return 1.0
		}
	}
	return 0.5
}

func calculateLocationMatch(target, user User) float64 {
	distance := getDistanceBetweenCities(target.City, user.City)
	if distance <= target.Preferences.LocationRange {
		return 1.0
	} else if distance <= target.Preferences.LocationRange*2 {
		return 0.5
	}
	return 0
}
```

---

## ä¸‰ã€å€™é€‰æ± ç­›é€‰ + åˆ†å±‚è¿‡æ»¤

```go
func filterCandidates(users []User, currentUser User) []User {
	var result []User

	// ç¬¬ä¸€å±‚ï¼šæ ¸å¿ƒæ¡ä»¶ç­›é€‰
	for _, u := range users {
		if calculateRequirementScore(currentUser, u) >= 1.0 {
			result = append(result, u)
		}
	}

	// å¦‚æœæ•°é‡è¶³å¤Ÿï¼Œç›´æ¥è¿”å›
	if len(result) >= 15 {
		return result[:15]
	}

	// ç¬¬äºŒå±‚ï¼šæ”¾å®½éæ ¸å¿ƒæ¡ä»¶
	result = append(result, filterWithRelaxedConditions(users, currentUser)...)

	// ç¬¬ä¸‰å±‚ï¼šä¿åº•æœºåˆ¶
	if len(result) < 15 {
		result = append(result, getFallbackUsers(currentUser, 15-len(result))...)
	}

	return result
}

func filterWithRelaxedConditions(users []User, currentUser User) []User {
	var relaxed []User

	// æ”¾å®½å¹´é¾„ Â±2å²
	currentUser.Preferences.MinAge -= 2
	currentUser.Preferences.MaxAge += 2

	// æ”¾å®½å­¦å†é™åˆ¶
	currentUser.Preferences.PreferredEdu = append(currentUser.Preferences.PreferredEdu, "å¤§ä¸“")

	// æ”¾å®½æ”¶å…¥
	currentUser.Preferences.MinIncome *= 0.8

	// å†æ¬¡ç­›é€‰
	for _, u := range users {
		if calculateRequirementScore(currentUser, u) >= 0.7 {
			relaxed = append(relaxed, u)
		}
	}

	return relaxed
}
```

---

## å››ã€ä¿åº•æœºåˆ¶

```go
func getFallbackUsers(currentUser User, count int) []User {
	// ä»æ´»è·ƒç”¨æˆ·ä¸­å–
	activeUsers := getActiveUsers()
	if len(activeUsers) >= count {
		return activeUsers[:count]
	}

	// ä¸è¶³åˆ™è¡¥å……æ–°ç”¨æˆ·æˆ–é«˜è´¨é‡ç”¨æˆ·
	newUsers := getNewOrHighQualityUsers(count - len(activeUsers))
	return append(activeUsers, newUsers...)
}
```

---

## äº”ã€Redis ç¼“å­˜ä¸å»é‡æœºåˆ¶

ä½¿ç”¨ Redis è®°å½•æ¯ä¸ªç”¨æˆ·å·²æ¨é€è¿‡çš„ IDï¼Œé¿å…é‡å¤ã€‚

```go
var redisClient *redis.Client

func initRedis() {
	redisClient = redis.NewClient(&redis.Options{
		Addr: "localhost:6379",
	})
}

func hasPushed(userID, targetID string) bool {
	exists, _ := redisClient.SIsMember(context.Background(), "pushed:"+userID, targetID).Result()
	return exists
}

func markAsPushed(userID, targetID string) {
	redisClient.SAdd(context.Background(), "pushed:"+userID, targetID)
	redisClient.Expire(context.Background(), "pushed:"+userID, 7*24*time.Hour) // 7å¤©å»é‡
}
```

---

## å…­ã€ä¸»æµç¨‹ç¤ºä¾‹

```go
func generateDailyRecommendations(currentUser User) []User {
	// è·å–æ‰€æœ‰å€™é€‰ç”¨æˆ·ï¼ˆå¯æ¥è‡ªæ•°æ®åº“æˆ–ç¼“å­˜ï¼‰
	allUsers := getAllUsers()

	// è¿‡æ»¤ + æ¨è
	candidates := filterCandidates(allUsers, currentUser)

	// æ’åºï¼ˆæŒ‰åŒ¹é…åº¦ï¼‰
	sort.Slice(candidates, func(i, j int) bool {
		scoreI := calculateMatchScore(currentUser, candidates[i])
		scoreJ := calculateMatchScore(currentUser, candidates[j])
		return scoreI > scoreJ
	})

	// å»é‡ + ç¼“å­˜
	var finalList []User
	for _, u := range candidates {
		if !hasPushed(currentUser.ID, u.ID) && len(finalList) < 15 {
			finalList = append(finalList, u)
			markAsPushed(currentUser.ID, u.ID)
		}
	}

	return finalList
}
```

---

## ä¸ƒã€å·¥å…·å‡½æ•°

```go
func containsString(slice []string, val string) bool {
	for _, s := range slice {
		if s == val {
			return true
		}
	}
	return false
}

func abs(x int) int {
	if x < 0 {
		return -x
	}
	return x
}

func clamp(x, min, max float64) float64 {
	if x < min {
		return min
	}
	if x > max {
		return max
	}
	return x
}

func getDistanceBetweenCities(cityA, cityB string) int {
	// å®é™…é¡¹ç›®ä¸­åº”è°ƒç”¨åœ°å›¾æœåŠ¡è·å–çœŸå®è·ç¦»
	return 10 // ç¤ºä¾‹å€¼
}

func getActiveUsers() []User {
	// æŸ¥è¯¢æ´»è·ƒç”¨æˆ·ï¼ˆå¦‚è¿‘7å¤©ç™»å½•ï¼‰
	return []User{}
}

func getNewOrHighQualityUsers(n int) []User {
	// æŸ¥è¯¢æ–°æ³¨å†Œæˆ–èµ„æ–™å®Œæ•´çš„ç”¨æˆ·
	return make([]User, n)
}

func getAllUsers() []User {
	// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼ˆå®é™…åº”åˆ†é¡µåŠ è½½ï¼‰
	return []User{} // ç¤ºä¾‹ç©ºæ•°æ®
}
```

---

## å…«ã€åç»­æ‰©å±•å»ºè®®

| åŠŸèƒ½         | æè¿°                                 |
| ------------ | ------------------------------------ |
| A/Bæµ‹è¯•æ”¯æŒ  | å¯¹ä¸åŒæ¨èç®—æ³•ç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”å®éªŒ       |
| ç”¨æˆ·åé¦ˆæ¥å£ | æä¾›â€œå–œæ¬¢â€ã€â€œä¸å–œæ¬¢â€æŒ‰é’®æ”¶é›†æ•°æ®     |
| æ¨èæ¨¡å‹å‡çº§ | å¼•å…¥ååŒè¿‡æ»¤ã€æ·±åº¦å­¦ä¹ æ¨¡å‹æå‡å‡†ç¡®ç‡ |
| å®æ—¶è¡Œä¸ºæ›´æ–° | ä½¿ç”¨ Kafka å®æ—¶æ›´æ–°æ¨èç»“æœ          |

---

## âœ… æ€»ç»“ä¸€å¥è¯

> è¯¥é¡¹ç›®é€šè¿‡ Go å®ç°äº†ä¸€ä¸ªå®Œæ•´ã€å¯è½åœ°çš„å©šæ‹å¹³å°ç”¨æˆ·æ¨èç³»ç»Ÿï¼Œå…·å¤‡ï¼š
> - å¤šç»´åº¦è¯„åˆ†åŒ¹é…
> - åŠ¨æ€æ”¾å®½ç­–ç•¥
> - ä¿åº•æœºåˆ¶
> - Redis ç¼“å­˜ä¼˜åŒ–
> - é¢å‘æœªæ¥å¯æ‰©å±•çš„æ¶æ„è®¾è®¡

