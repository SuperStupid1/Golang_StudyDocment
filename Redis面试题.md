# 📚 Redis 面试题大全

## 🔑 基础概念

### 1. Redis是什么？有哪些特点？
**答案**：
Redis是开源的内存数据结构存储，特点包括：
1. 高性能(10万+/秒读写)
2. 支持多种数据结构
3. 持久化选项
4. 高可用架构
5. 丰富的客户端支持

### 2. Redis适合哪些应用场景？
**答案**：
1. 缓存系统
2. 会话存储
3. 排行榜/计数器
4. 消息队列
5. 实时系统

## 🧩 数据类型

### 3. Redis支持哪些数据类型？
**答案**：
1. String: 字符串
2. Hash: 哈希表
3. List: 链表
4. Set: 无序集合
5. Sorted Set: 有序集合
6. Bitmap/HyperLogLog/Geospatial等

### 4. 如何选择合适的数据类型？
**答案**：
1. 简单KV用String
2. 对象存储用Hash
3. 队列/栈用List
4. 去重用Set
5. 排行榜用Sorted Set

## 💾 持久化

### 5. Redis有哪几种持久化方式？
**答案**：
1. RDB(快照)
2. AOF(追加日志)
3. 混合模式(Redis 4.0+)

### 6. RDB和AOF有什么区别？
**答案**：
| 特性 | RDB | AOF |
|------|-----|-----|
| 恢复速度 | 快 | 慢 |
| 数据安全 | 可能丢失数据 | 更高 |
| 文件大小 | 小 | 大 |
| 性能影响 | 高 | 低 |

## ⚡ 性能优化

### 7. 如何提高Redis性能？
**答案**：
1. 使用Pipeline减少RTT
2. 合理选择数据结构
3. 控制Key大小
4. 使用连接池
5. 避免大Key

### 8. 什么是Redis Pipeline？
**答案**：
批量发送命令机制，减少网络往返时间(RTT)，提升吞吐量。

```bash
# 示例
$ echo -e "SET key1 value1\nGET key1\nDEL key1" | redis-cli --pipe
```

## 🔒 分布式

### 9. Redis如何实现分布式锁？
**答案**：
使用SETNX命令：
```bash
SET lock_key unique_value NX PX 30000
```
解锁时需验证value并删除。

### 10. Redis Cluster工作原理？
**答案**：
1. 16384个哈希槽
2. 节点负责部分槽
3. 客户端重定向
4. Gossip协议通信

## 🚦 高可用

### 11. Redis Sentinel是什么？
**答案**：
高可用解决方案，功能包括：
1. 监控
2. 通知
3. 自动故障转移
4. 配置提供

### 12. 主从复制流程？
**答案**：
1. 从节点保存主节点信息
2. 建立socket连接
3. 发送PING命令
4. 权限验证
5. 同步数据集
6. 持续命令传播

## 🔄 内存管理

### 13. Redis内存淘汰策略有哪些？
**答案**：
1. noeviction: 不淘汰
2. allkeys-lru: 全体LRU
3. volatile-lru: 过期集合LRU
4. allkeys-random: 全体随机
5. volatile-random: 过期集合随机
6. volatile-ttl: 淘汰TTL小的

### 14. 如何分析大Key？
**答案**：
1. redis-cli --bigkeys
2. SCAN+DEBUG OBJECT
3. RDB分析工具

## 🛠️ 运维相关

### 15. 如何安全重启Redis？
**答案**：
1. 开启持久化
2. 执行SHUTDOWN SAVE
3. 等待持久化完成
4. 重启服务

### 16. 如何监控Redis？
**答案**：
1. INFO命令
2. redis-stat工具
3. Prometheus+Granfana
4. 慢查询日志

## 💡 高级特性

### 17. Redis事务特点？
**答案**：
1. 批量执行
2. 原子性
3. 不支持回滚
4. 隔离性

### 18. Lua脚本有什么优势？
**答案**：
1. 减少网络开销
2. 原子性执行
3. 复用逻辑
4. 复杂操作封装

## 🔄 集群管理

### 19. 如何扩容Redis Cluster？
**答案**：
1. 添加新节点
2. 迁移哈希槽
3. 更新集群配置
4. 客户端重定向

### 20. 如何解决数据倾斜？
**答案**：
1. 分析大Key
2. 拆分大Key
3. 使用Hash Tag
4. 调整槽分布

## 🚀 实战应用

### 21. 如何实现延迟队列？
**答案**：
使用Sorted Set：
```bash
ZADD delay_queue <timestamp> task_id
ZRANGEBYSCORE delay_queue 0 <current_timestamp>
```

### 22. 如何实现分布式限流？
**答案**：
使用INCR+EXPIRE：
```lua
local key = "rate_limit:" .. KEYS[1]
local limit = tonumber(ARGV[1])
local current = tonumber(redis.call('get', key) or "0")
if current + 1 > limit then
    return 0
else
    redis.call("INCR", key)
    redis.call("EXPIRE", key, ARGV[2])
    return 1
end
```

## 🔍 性能分析

### 23. 如何诊断Redis性能问题？
**答案**：
1. 检查慢查询日志
2. 分析INFO命令输出
3. 监控内存使用
4. 网络延迟测试

### 24. 连接数过多怎么处理？
**答案**：
1. 使用连接池
2. 调整timeout
3. 限制客户端连接数
4. 分析连接来源

## 🛡️ 安全机制

### 25. 如何保证Redis安全？
**答案**：
1. 设置密码
2. 绑定IP
3. 禁用危险命令
4. 使用SSL
5. 最小权限原则

### 26. Redis有哪些危险命令？
**答案**：
1. FLUSHALL/FLUSHDB
2. KEYS
3. CONFIG
4. DEBUG
5. SHUTDOWN

## 🔄 数据同步

### 27. 主从复制延迟怎么解决？
**答案**：
1. 优化主节点性能
2. 减少大Key
3. 使用PSYNC2
4. 监控复制偏移量

### 28. 如何保证数据一致性？
**答案**：
1. 合理设置持久化
2. 使用WAIT命令
3. 监控复制状态
4. 最终一致性设计

## 🧠 缓存策略

### 29. 缓存雪崩是什么？如何预防？
**答案**：
大量缓存同时失效导致DB压力骤增。预防：
1. 随机过期时间
2. 多级缓存
3. 熔断机制

### 30. 缓存穿透是什么？如何预防？
**答案**：
查询不存在的数据导致直接访问DB。预防：
1. 布隆过滤器
2. 空值缓存
3. 参数校验

## ⚙️ 配置优化

### 31. 重要配置参数有哪些？
**答案**：
1. maxmemory
2. maxmemory-policy
3. timeout
4. tcp-keepalive
5. hz

### 32. 如何选择合适的内存淘汰策略？
**答案**：
1. 缓存场景: allkeys-lru
2. 持久化场景: volatile-lru
3. 严格不丢失: noeviction

## 🔄 集群运维

### 33. 如何手动故障转移？
**答案**：
1. 在从节点执行CLUSTER FAILOVER
2. 等待主从切换
3. 更新客户端配置

### 34. 如何修复集群脑裂？
**答案**：
1. 强制下线异常节点
2. 手动故障转移
3. 恢复网络分区
4. 数据一致性检查

## 💡 新特性

### 35. Redis 6.0多线程模型？
**答案**：
1. IO多线程
2. 命令执行仍单线程
3. 提升网络性能
4. 配置项: io-threads

### 36. Redis Stream是什么？
**答案**：
消息队列实现，特点：
1. 消息持久化
2. 消费者组
3. 消息回溯
4. ACK机制

## 🛠️ 工具使用

### 37. redis-cli常用技巧？
**答案**：
1. --stat: 实时统计
2. --bigkeys: 大Key分析
3. --scan: 模式扫描
4. --pipe: 批量导入

### 38. 如何分析内存使用？
**答案**：
1. INFO memory
2. redis-rdb-tools
3. MEMORY USAGE命令
4. MEMORY STATS

## 🔄 数据迁移

### 39. 如何迁移Redis数据？
**答案**：
1. MIGRATE命令
2. 复制RDB文件
3. 使用工具(redis-port)
4. 双写策略

### 40. 如何平滑迁移集群？
**答案**：
1. 增量同步
2. 客户端双写
3. 验证数据一致性
4. 切换流量

## 🧠 高级应用

### 41. 如何实现分布式Session？
**答案**：
1. 使用Redis存储Session
2. 设置合理过期时间
3. 加密Session数据
4. 多机房部署

### 42. 如何实现秒杀系统？
**答案**：
1. 库存预减
2. 消息队列削峰
3. 限流措施
4. 缓存热点数据

## ⚡ 性能调优

### 43. 如何优化大量写入？
**答案**：
1. Pipeline批量操作
2. 多实例分片
3. 异步写入
4. 避免大Key

### 44. 如何优化大量读取？
**答案**：
1. 增加从节点
2. 客户端缓存
3. 连接池优化
4. 数据结构优化

## 🔒 安全实践

### 45. 如何防止命令注入？
**答案**：
1. 参数校验
2. 使用Lua脚本
3. 禁用危险命令
4. 最小权限

### 46. 如何审计Redis操作？
**答案**：
1. 开启AOF
2. 使用MONITOR命令
3. 第三方审计工具
4. 日志分析

## 🚀 集群设计

### 47. 如何设计高可用架构？
**答案**：
1. 主从+Sentinel
2. Cluster模式
3. 多机房部署
4. 自动故障检测

### 48. 如何选择集群规模？
**答案**：
1. 数据量大小
2. QPS需求
3. 容灾要求
4. 运维成本

## 💾 持久化调优

### 49. 如何优化RDB性能？
**答案**：
1. 调整save参数
2. 低峰期执行
3. 使用BGSAVE
4. 避免大Key

### 50. 如何优化AOF性能？
**答案**：
1. 调整appendfsync
2. 使用AOF重写
3. 优化磁盘IO
4. 混合持久化
