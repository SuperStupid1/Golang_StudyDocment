# **Go é¢è¯•ç›¸å…³å†…å®¹**

---

# ğŸ§  ä¸€ã€Go åŸºç¡€è¯­æ³•è¯¦è§£ï¼ˆå«åº•å±‚åŸç†ï¼‰

## âœ… 1. Go çš„åŸºæœ¬æ•°æ®ç±»å‹ä¸å†…å­˜å¸ƒå±€

### ğŸ”¢ ç±»å‹å¤§å°ï¼ˆ64ä½ç³»ç»Ÿä¸‹ï¼‰

| ç±»å‹            | å­—èŠ‚æ•°                | æè¿°                                |
| --------------- | --------------------- | ----------------------------------- |
| bool            | 1 byte                | å­˜å‚¨ true/false                     |
| int/uint        | 8 bytes               | é»˜è®¤æ˜¯ int64 æˆ– uint64              |
| int8/uint8      | 1 byte                | ç­‰ä»·äº byte                         |
| rune            | 4 bytes               | UTF-32 ç¼–ç çš„ Unicode å­—ç¬¦ï¼ˆint32ï¼‰ |
| float32/float64 | 4 / 8 bytes           | æµ®ç‚¹æ•°                              |
| string          | ä¸¤ä¸ª wordï¼ˆ16 bytesï¼‰ | æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ + é•¿åº¦           |
| slice           | ä¸‰ä¸ª wordï¼ˆ24 bytesï¼‰ | æŒ‡é’ˆ + len + cap                    |
| map             | ä¸€ä¸ª wordï¼ˆ8 bytesï¼‰  | å®é™…æŒ‡å‘è¿è¡Œæ—¶ç»“æ„ä½“ `hmap`         |
| interface{}     | ä¸¤ä¸ª wordï¼ˆ16 bytesï¼‰ | åŠ¨æ€ç±»å‹ä¿¡æ¯ + åŠ¨æ€å€¼               |

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼š`interface{}` å’Œå…·ä½“ç±»å‹ä¹‹é—´çš„è½¬æ¢æˆæœ¬ï¼›`string` æ˜¯ä¸å¯å˜çš„ï¼›slice æ˜¯å¼•ç”¨ç±»å‹ã€‚

---

## âœ… 2. struct å†…å­˜å¯¹é½ä¸å­—æ®µé¡ºåºä¼˜åŒ–

Go ä¸­ struct çš„å­—æ®µä¼šè‡ªåŠ¨è¿›è¡Œå†…å­˜å¯¹é½ï¼Œä»¥æé«˜è®¿é—®æ•ˆç‡ã€‚

```go
type A struct {
    a bool
    b int32
    c int64
}
```

- `bool` å  1 å­—èŠ‚ï¼Œä½†ä¸ºäº†å¯¹é½ `int32`ï¼Œåé¢ä¼šå¡«å…… 3 å­—èŠ‚ï¼›
- `int32` å  4 å­—èŠ‚ï¼›
- `int64` å  8 å­—èŠ‚ï¼Œå‰é¢åˆšå¥½æ˜¯ 8 å­—èŠ‚è¾¹ç•Œã€‚

**æ€»å¤§å° = 1 + 3(padding) + 4 + 8 = 16 bytes**

> é¢è¯•å¸¸é—®ï¼šstruct çš„å†…å­˜å¸ƒå±€æ˜¯å¦ä¼šå½±å“æ€§èƒ½ï¼Ÿç­”ï¼šæ˜¯çš„ï¼Œå­—æ®µé¡ºåºä¼šå½±å“ padding å¤§å°å’Œ cache line åˆ©ç”¨ç‡ã€‚

---

## âœ… 3. å‡½æ•°è°ƒç”¨æ ˆä¸ defer çš„å®ç°æœºåˆ¶

Go çš„å‡½æ•°è°ƒç”¨ä½¿ç”¨**æ ˆåˆ†é…æœºåˆ¶**ï¼Œå‚æ•°ã€å±€éƒ¨å˜é‡éƒ½åœ¨æ ˆä¸Šã€‚defer å…³é”®å­—ä¼šåœ¨å‡½æ•°è¿”å›å‰æ‰§è¡Œï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š

- defer è®°å½•ä¼šè¢«å‹å…¥å½“å‰ goroutine çš„ defer æ ˆä¸­ï¼›
- åœ¨å‡½æ•° return åï¼ŒæŒ‰åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰é¡ºåºæ‰§è¡Œï¼›
- å¦‚æœæœ‰å¤šä¸ª deferï¼ŒæŒ‰å£°æ˜é¡ºåºé€†åºæ‰§è¡Œã€‚

```go
func f() {
    defer fmt.Println("first")
    defer fmt.Println("second")
}
// è¾“å‡ºï¼š
// second
// first
```

> é¢è¯•æ³¨æ„ï¼šdefer çš„é—­åŒ…æ•è·çš„æ˜¯å˜é‡çš„å€¼è¿˜æ˜¯å¼•ç”¨ï¼Ÿ

```go
i := 0
defer fmt.Println(i) // æ‰“å° 0
i++
```

- `fmt.Println(i)` ä¸­çš„ i æ˜¯ defer æ³¨å†Œæ—¶çš„æ‹·è´ã€‚
- å¦‚æœå†™æˆ `defer func() { fmt.Println(i) }()`ï¼Œåˆ™æ‰“å° 1ã€‚

---

## âœ… 4. æ¥å£ interface{} ä¸å…·ä½“ç±»å‹çš„è½¬æ¢

Go çš„æ¥å£åˆ†ä¸ºä¸¤ç§ï¼š

- **ç©ºæ¥å£ `interface{}`**ï¼šå¯ä»¥æ¥æ”¶ä»»ä½•ç±»å‹ã€‚
- **å¸¦æ–¹æ³•çš„æ¥å£ `io.Reader`**ï¼šå¿…é¡»å®ç°å¯¹åº”æ–¹æ³•ã€‚

### æ¥å£çš„å†…éƒ¨ç»“æ„ï¼ˆåå°„ç›¸å…³ï¼‰ï¼š

```go
type iface struct {
    tab  *itab     // æ¥å£å…ƒä¿¡æ¯
    data unsafe.Pointer // æŒ‡å‘å…·ä½“å€¼
}
```

å…¶ä¸­ `itab` åŒ…å«äº†åŠ¨æ€ç±»å‹ä¿¡æ¯ï¼ˆå¦‚ typeã€hashã€æ–¹æ³•è¡¨ç­‰ï¼‰ã€‚

> é¢è¯•é«˜é¢‘é—®é¢˜ï¼šå¦‚ä½•åˆ¤æ–­ä¸€ä¸ª interface æ˜¯å¦ä¸º nilï¼Ÿ

```go
var r io.Reader
var buf *bytes.Buffer = nil
r = buf
fmt.Println(r == nil) // false
```

- å› ä¸ºæ­¤æ—¶ `r.tab != nil`ï¼Œåªæ˜¯ `data == nil`
- æ‰€ä»¥ä¸èƒ½ç›´æ¥ç”¨ `if r == nil` æ¥åˆ¤æ–­

---

## âœ… 5. æ•°ç»„ä¸åˆ‡ç‰‡çš„åº•å±‚å®ç°

### ğŸ”¢ æ•°ç»„ï¼ˆArrayï¼‰

- å›ºå®šé•¿åº¦çš„è¿ç»­å†…å­˜ç©ºé—´
- å€¼ç±»å‹ï¼Œèµ‹å€¼æˆ–ä¼ å‚ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„
- é•¿åº¦æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œ`[3]int` å’Œ `[4]int` æ˜¯ä¸åŒç±»å‹

```go
// å£°æ˜ä¸åˆå§‹åŒ–
var arr1 [5]int                     // é›¶å€¼åˆå§‹åŒ–ä¸º [0,0,0,0,0]
arr2 := [3]int{1, 2, 3}             // æ˜¾å¼åˆå§‹åŒ–
arr3 := [...]int{1, 2, 3, 4}        // ç¼–è¯‘å™¨è‡ªåŠ¨è®¡ç®—é•¿åº¦
arr4 := [5]int{1: 10, 3: 30}        // æŒ‡å®šç´¢å¼•åˆå§‹åŒ– [0,10,0,30,0]
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šæ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’æ—¶æ˜¯å€¼ä¼ é€’ï¼Œä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

### ğŸ”¢ åˆ‡ç‰‡ï¼ˆSliceï¼‰

- å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œç”±æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡ä¸‰éƒ¨åˆ†ç»„æˆ
- å¼•ç”¨ç±»å‹ï¼Œä¼ é€’åˆ‡ç‰‡åªä¼šå¤åˆ¶åˆ‡ç‰‡ç»“æ„ä½“ï¼ˆ24å­—èŠ‚ï¼‰ï¼Œä¸ä¼šå¤åˆ¶åº•å±‚æ•°ç»„
- åŠ¨æ€æ‰©å®¹ï¼Œå½“å®¹é‡ä¸è¶³æ—¶ä¼šåˆ†é…æ–°æ•°ç»„å¹¶å¤åˆ¶æ•°æ®

```go
// åº•å±‚ç»“æ„
type slice struct {
    array unsafe.Pointer  // æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ
    len   int             // åˆ‡ç‰‡é•¿åº¦
    cap   int             // åˆ‡ç‰‡å®¹é‡
}

// å£°æ˜ä¸åˆå§‹åŒ–
var s1 []int                        // nil åˆ‡ç‰‡ï¼Œlen=0, cap=0, array=nil
s2 := []int{}                       // ç©ºåˆ‡ç‰‡ï¼Œlen=0, cap=0, arrayâ‰ nil
s3 := []int{1, 2, 3}                // æœ‰3ä¸ªå…ƒç´ çš„åˆ‡ç‰‡
s4 := make([]int, 5)                // é•¿åº¦ä¸º5ï¼Œå®¹é‡ä¸º5çš„åˆ‡ç‰‡
s5 := make([]int, 3, 5)             // é•¿åº¦ä¸º3ï¼Œå®¹é‡ä¸º5çš„åˆ‡ç‰‡
s6 := arr[1:4]                      // ä»æ•°ç»„åˆ›å»ºåˆ‡ç‰‡
```

#### åˆ‡ç‰‡æ‰©å®¹æœºåˆ¶ï¼š

- å½“ `append` æ“ä½œå¯¼è‡´åˆ‡ç‰‡è¶…å‡ºå®¹é‡æ—¶è§¦å‘æ‰©å®¹
- Go 1.18 ä¹‹å‰ï¼šå½“æ‰€éœ€å®¹é‡ â‰¤ 1024 æ—¶ï¼Œæ–°å®¹é‡ = æ—§å®¹é‡Ã—2ï¼›å½“ > 1024 æ—¶ï¼Œæ–°å®¹é‡ = æ—§å®¹é‡Ã—1.25
- Go 1.18 ä¹‹åï¼šæ ¹æ®å…ƒç´ å¤§å°å’Œå½“å‰å®¹é‡åŠ¨æ€è°ƒæ•´å¢é•¿å› å­

```go
s := []int{1, 2}  // len=2, cap=2
s = append(s, 3)  // è§¦å‘æ‰©å®¹ï¼Œlen=3, cap=4
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šnil åˆ‡ç‰‡ vs ç©ºåˆ‡ç‰‡ï¼›åˆ‡ç‰‡æ‰©å®¹æœºåˆ¶ï¼›åˆ‡ç‰‡ä½œä¸ºå‡½æ•°å‚æ•°æ—¶çš„æ³¨æ„äº‹é¡¹ã€‚

---

## âœ… 6. Map çš„å®ç°åŸç†ä¸æ€§èƒ½ä¼˜åŒ–

### ğŸ”¢ åº•å±‚ç»“æ„ï¼š

Map åœ¨ Go ä¸­æ˜¯å“ˆå¸Œè¡¨çš„å®ç°ï¼Œå…¶åº•å±‚ç»“æ„ä¸º `runtime.hmap`ï¼š

```go
type hmap struct {
    count     int            // å…ƒç´ ä¸ªæ•°
    flags     uint8          // çŠ¶æ€æ ‡å¿—
    B         uint8          // æ¡¶æ•°é‡çš„å¯¹æ•° log_2
    noverflow uint16         // æº¢å‡ºæ¡¶çš„è¿‘ä¼¼æ•°
    hash0     uint32         // å“ˆå¸Œç§å­
    buckets    unsafe.Pointer // æŒ‡å‘æ¡¶æ•°ç»„çš„æŒ‡é’ˆ
    oldbuckets unsafe.Pointer // æ‰©å®¹æ—¶æŒ‡å‘æ—§æ¡¶çš„æŒ‡é’ˆ
    nevacuate  uintptr       // æ‰©å®¹æ—¶çš„è¿›åº¦è®¡æ•°å™¨
    extra     *mapextra      // å¯é€‰å­—æ®µ
}
```

### ğŸ”¢ åŸºæœ¬æ“ä½œï¼š

```go
// å£°æ˜ä¸åˆå§‹åŒ–
var m1 map[string]int           // nil mapï¼Œä¸èƒ½ç›´æ¥èµ‹å€¼
m2 := make(map[string]int)      // ç©º mapï¼Œå¯ä»¥ä½¿ç”¨
m3 := map[string]int{           // å­—é¢é‡åˆå§‹åŒ–
    "one": 1,
    "two": 2,
}

// å¢åˆ æ”¹æŸ¥
m2["three"] = 3                 // æ·»åŠ æˆ–ä¿®æ”¹
value, exists := m2["three"]    // æŸ¥è¯¢ï¼Œexists è¡¨ç¤ºé”®æ˜¯å¦å­˜åœ¨
delete(m2, "three")             // åˆ é™¤
```

### ğŸ”¢ å“ˆå¸Œå†²çªä¸æ‰©å®¹ï¼š

- ä½¿ç”¨é“¾åœ°å€æ³•è§£å†³å†²çªï¼ˆæ¡¶å†…ä½¿ç”¨æ•°ç»„å­˜å‚¨ï¼Œæº¢å‡ºåˆ™ä½¿ç”¨é¢å¤–çš„æ¡¶ï¼‰
- è´Ÿè½½å› å­è¶…è¿‡ 6.5 æˆ–æº¢å‡ºæ¡¶è¿‡å¤šæ—¶è§¦å‘æ‰©å®¹
- æ‰©å®¹åˆ†ä¸ºç­‰é‡æ‰©å®¹ï¼ˆè§£å†³æº¢å‡ºæ¡¶è¿‡å¤šï¼‰å’Œç¿»å€æ‰©å®¹ï¼ˆè§£å†³è´Ÿè½½å› å­è¿‡å¤§ï¼‰
- æ‰©å®¹æ˜¯æ¸è¿›å¼çš„ï¼Œæ¯æ¬¡è®¿é—® map æ—¶è¿ç§»å°‘é‡æ•°æ®

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šmap ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼›map çš„é”®å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„ç±»å‹ï¼›map éå†é¡ºåºæ˜¯éšæœºçš„ã€‚

---

## âœ… 7. å­—ç¬¦ä¸²ï¼ˆStringï¼‰ä¸å­—èŠ‚æ“ä½œ

### ğŸ”¢ å­—ç¬¦ä¸²ç‰¹æ€§ï¼š

- ä¸å¯å˜çš„å­—èŠ‚åºåˆ—ï¼Œåº•å±‚ä¸º `[]byte`
- å†…éƒ¨ç»“æ„åŒ…å«æŒ‡å‘å­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆå’Œé•¿åº¦
- UTF-8 ç¼–ç ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦é€šå¸¸å  3 ä¸ªå­—èŠ‚

```go
// åº•å±‚ç»“æ„
type stringStruct struct {
    str unsafe.Pointer  // æŒ‡å‘å­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆ
    len int             // å­—ç¬¦ä¸²é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰
}

// åŸºæœ¬æ“ä½œ
s1 := "hello"
s2 := s1 + " world"     // åˆ›å»ºæ–°å­—ç¬¦ä¸²ï¼Œä¸ä¿®æ”¹åŸå­—ç¬¦ä¸²
s3 := s1[:2]            // å­ä¸²ï¼Œå…±äº«åº•å±‚æ•°ç»„

// å­—ç¬¦éå†
for i, b := range "hello" {      // b æ˜¯ rune (int32)ï¼Œä¸æ˜¯ byte
    fmt.Printf("%d: %c\n", i, b)
}
```

### ğŸ”¢ å­—ç¬¦ä¸²ä¸ []byte è½¬æ¢ï¼š

```go
s := "hello"
b := []byte(s)          // åˆ†é…æ–°å†…å­˜å¹¶å¤åˆ¶å†…å®¹
s2 := string(b)         // åˆ†é…æ–°å†…å­˜å¹¶å¤åˆ¶å†…å®¹
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šå­—ç¬¦ä¸²ä¸ []byte äº’è½¬ä¼šåˆ†é…æ–°å†…å­˜ï¼›å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œä»»ä½•ä¿®æ”¹æ“ä½œéƒ½ä¼šåˆ›å»ºæ–°å­—ç¬¦ä¸²ï¼›Go ä¸­çš„å­—ç¬¦ä¸²é»˜è®¤æ˜¯ UTF-8 ç¼–ç ã€‚

---

## âœ… 8. for å’Œ range çš„å®ç°æœºåˆ¶

### ğŸ”¢ for å¾ªç¯ï¼š

```go
// åŸºæœ¬ for å¾ªç¯
for i := 0; i < 10; i++ {
    // å¾ªç¯ä½“
}

// æ— é™å¾ªç¯
for {
    // å¾ªç¯ä½“
    if condition {
        break
    }
}

// while é£æ ¼
for condition {
    // å¾ªç¯ä½“
}
```

### ğŸ”¢ range å¾ªç¯ï¼š

range åœ¨ç¼–è¯‘æ—¶ä¼šè¢«è½¬æ¢ä¸ºæ™®é€š for å¾ªç¯ï¼Œä½†æœ‰ä¸€äº›ç‰¹æ®Šè¡Œä¸ºï¼š

```go
// éå†åˆ‡ç‰‡
for i, v := range slice {
    // i æ˜¯ç´¢å¼•ï¼Œv æ˜¯å…ƒç´ çš„å‰¯æœ¬
}

// éå† map
for k, v := range myMap {
    // k æ˜¯é”®çš„å‰¯æœ¬ï¼Œv æ˜¯å€¼çš„å‰¯æœ¬
}

// éå†å­—ç¬¦ä¸²
for i, r := range "hello" {
    // i æ˜¯å­—èŠ‚ç´¢å¼•ï¼Œr æ˜¯ rune å€¼
}

// éå†é€šé“
for v := range ch {
    // v æ˜¯ä»é€šé“æ¥æ”¶çš„å€¼
}
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šrange å¾ªç¯ä¸­çš„å˜é‡æ˜¯å¾ªç¯å†…éƒ¨çš„å‰¯æœ¬ï¼Œæ¯æ¬¡è¿­ä»£ä¼šé‡ç”¨è¿™äº›å˜é‡ï¼›éå† map çš„é¡ºåºæ˜¯éšæœºçš„ï¼›éå†å­—ç¬¦ä¸²æ—¶å¤„ç†çš„æ˜¯ rune è€Œé byteã€‚

---

## âœ… 9. å‡½æ•°ä¸æ–¹æ³•

### ğŸ”¢ å‡½æ•°ç‰¹æ€§ï¼š

- ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä»¥ä½œä¸ºå€¼ä¼ é€’
- æ”¯æŒå¤šè¿”å›å€¼
- æ”¯æŒå‘½åè¿”å›å€¼
- æ”¯æŒå¯å˜å‚æ•°

```go
// åŸºæœ¬å‡½æ•°
func add(a, b int) int {
    return a + b
}

// å¤šè¿”å›å€¼
func divide(a, b int) (int, error) {
    if b == 0 {
        return 0, errors.New("é™¤æ•°ä¸èƒ½ä¸ºé›¶")
    }
    return a / b, nil
}

// å‘½åè¿”å›å€¼
func rectangle(width, height int) (area, perimeter int) {
    area = width * height
    perimeter = 2 * (width + height)
    return // éšå¼è¿”å›å‘½åè¿”å›å€¼
}

// å¯å˜å‚æ•°
func sum(nums ...int) int {
    total := 0
    for _, num := range nums {
        total += num
    }
    return total
}

// å‡½æ•°ä½œä¸ºå€¼
func apply(fn func(int, int) int, a, b int) int {
    return fn(a, b)
}
result := apply(add, 5, 3) // ä¼ é€’å‡½æ•°ä½œä¸ºå‚æ•°
```

### ğŸ”¢ æ–¹æ³•ï¼š

- å¸¦æ¥æ”¶è€…çš„å‡½æ•°
- æ¥æ”¶è€…å¯ä»¥æ˜¯å€¼ç±»å‹æˆ–æŒ‡é’ˆç±»å‹

```go
type Rectangle struct {
    Width, Height float64
}

// å€¼æ¥æ”¶è€…
func (r Rectangle) Area() float64 {
    return r.Width * r.Height
}

// æŒ‡é’ˆæ¥æ”¶è€…
func (r *Rectangle) Scale(factor float64) {
    r.Width *= factor
    r.Height *= factor
}
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šå€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€…çš„é€‰æ‹©ï¼›æ–¹æ³•é›†åˆè§„åˆ™ï¼›æ–¹æ³•è¡¨è¾¾å¼ä¸æ–¹æ³•å€¼ã€‚

---

## âœ… 10. é—­åŒ…ä¸åŒ¿åå‡½æ•°

### ğŸ”¢ åŸºæœ¬æ¦‚å¿µï¼š

- é—­åŒ…æ˜¯å¼•ç”¨äº†å¤–éƒ¨å˜é‡çš„å‡½æ•°
- åŒ¿åå‡½æ•°æ˜¯æ²¡æœ‰åç§°çš„å‡½æ•°
- é—­åŒ…æ•è·çš„å˜é‡åœ¨å‡½æ•°è¿”å›åä»ç„¶å­˜åœ¨

```go
// ç®€å•é—­åŒ…
func adder() func(int) int {
    sum := 0
    return func(x int) int {
        sum += x
        return sum
    }
}

// ä½¿ç”¨é—­åŒ…
counter := adder()
fmt.Println(counter(1)) // 1
fmt.Println(counter(2)) // 3
fmt.Println(counter(3)) // 6

// åŒ¿åå‡½æ•°ç›´æ¥è°ƒç”¨
result := func(a, b int) int {
    return a + b
}(5, 3)
```

### ğŸ”¢ é—­åŒ…é™·é˜±ï¼š

```go
// å¸¸è§é”™è¯¯ï¼šåœ¨å¾ªç¯ä¸­ç›´æ¥ä½¿ç”¨å¾ªç¯å˜é‡
funcs := make([]func(), 0)
for i := 0; i < 3; i++ {
    funcs = append(funcs, func() {
        fmt.Println(i) // æ‰€æœ‰å‡½æ•°éƒ½ä¼šæ‰“å° 3
    })
}

// æ­£ç¡®åšæ³•ï¼šåˆ›å»ºå±€éƒ¨å˜é‡
for i := 0; i < 3; i++ {
    i := i // åˆ›å»ºå±€éƒ¨å˜é‡
    funcs = append(funcs, func() {
        fmt.Println(i) // ä¼šåˆ†åˆ«æ‰“å° 0, 1, 2
    })
}
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šé—­åŒ…æ•è·å˜é‡çš„æ–¹å¼ï¼ˆå¼•ç”¨æ•è·ï¼‰ï¼›é—­åŒ…å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼›åœ¨ goroutine ä¸­ä½¿ç”¨é—­åŒ…çš„æ³¨æ„äº‹é¡¹ã€‚

------

## âœ… 11. æŒ‡é’ˆï¼ˆPointerï¼‰

### ğŸ”¢ åŸºæœ¬æ¦‚å¿µï¼š

- æŒ‡é’ˆå­˜å‚¨å˜é‡çš„å†…å­˜åœ°å€ã€‚
- `&` æ“ä½œç¬¦ç”¨äºè·å–å˜é‡çš„åœ°å€ã€‚
- `*` æ“ä½œç¬¦ç”¨äºè®¿é—®æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼ˆè§£å¼•ç”¨ï¼‰ã€‚
- é›¶å€¼ä¸º `nil`ã€‚

```go
var a int = 10
var p *int // å£°æ˜ä¸€ä¸ªæŒ‡å‘ int çš„æŒ‡é’ˆ
p = &a     // å°† a çš„åœ°å€èµ‹ç»™ p

fmt.Println("a çš„å€¼:", a)   // è¾“å‡º: 10
fmt.Println("a çš„åœ°å€:", &a) // è¾“å‡º: 0xc00001a080 (ç¤ºä¾‹åœ°å€)
fmt.Println("p çš„å€¼ (åœ°å€):", p) // è¾“å‡º: 0xc00001a080
fmt.Println("p æŒ‡å‘çš„å€¼:", *p) // è¾“å‡º: 10

*p = 20 // é€šè¿‡æŒ‡é’ˆä¿®æ”¹å˜é‡çš„å€¼
fmt.Println("ä¿®æ”¹å a çš„å€¼:", a) // è¾“å‡º: 20
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šå€¼ç±»å‹ vs å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆä¼ é€’ vs å€¼ä¼ é€’ï¼‰ã€‚å‡½æ•°å‚æ•°ä¼ é€’æ—¶ï¼Œé»˜è®¤æ˜¯å€¼æ‹·è´ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹åŸå˜é‡ï¼Œéœ€è¦ä¼ é€’æŒ‡é’ˆã€‚

---

## âœ… 12. å¸¸é‡ï¼ˆConstantï¼‰ä¸ iota

### ğŸ”¢ å¸¸é‡ï¼š

- ä½¿ç”¨ `const` å…³é”®å­—å®šä¹‰ï¼Œå€¼åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚
- å¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ã€å­—ç¬¦ä¸²æˆ–å¸ƒå°”å€¼ã€‚
- æ— æ³•ä¿®æ”¹ã€‚

```go
const Pi = 3.14159
const Greeting = "Hello"
```

### ğŸ”¢ iotaï¼š

- ç”¨äºç”Ÿæˆä¸€ç³»åˆ—é€’å¢çš„å¸¸é‡å€¼ã€‚
- åœ¨ `const` å£°æ˜å—ä¸­ï¼Œiota ä» 0 å¼€å§‹ï¼Œæ¯è¡Œé€’å¢ 1ã€‚

```go
const (
    A = iota // 0
    B        // 1
    C        // 2
)

const (
    D = iota // 0
    E = 10   // 10
    F        // 10 (iota åœ¨è¿™è¡Œæ˜¯ 2ï¼Œä½† F ç»§æ‰¿äº† E çš„å€¼)
    G = iota // 3 (iota æ¢å¤é€’å¢)
)
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šiota çš„ä½¿ç”¨åœºæ™¯ï¼ˆå¦‚æšä¸¾ç±»å‹ï¼‰ã€iota åœ¨ä¸åŒ const å—ä¸­çš„è¡Œä¸ºã€‚

---

## âœ… 13. ç±»å‹åµŒå…¥ï¼ˆç»„åˆï¼‰

### ğŸ”¢ æ¦‚å¿µï¼š

- Go æ²¡æœ‰ä¼ ç»Ÿçš„ç±»ç»§æ‰¿ï¼Œé€šè¿‡**ç±»å‹åµŒå…¥**å®ç°ç±»ä¼¼"ç»§æ‰¿"çš„æ•ˆæœã€‚
- å°†ä¸€ä¸ªç»“æ„ä½“ç±»å‹ç›´æ¥ä½œä¸ºå¦ä¸€ä¸ªç»“æ„ä½“çš„å­—æ®µï¼ˆä¸æŒ‡å®šå­—æ®µåï¼‰ã€‚
- è¢«åµŒå…¥çš„ç»“æ„ä½“çš„æ–¹æ³•å’Œå­—æ®µä¼šè¢«"æå‡"åˆ°å¤–éƒ¨ç»“æ„ä½“ã€‚

```go
type Animal struct {
    Name string
}

func (a Animal) Speak() {
    fmt.Println("Animal speaks")
}

type Dog struct {
    Animal // åµŒå…¥ Animal ç±»å‹
    Breed  string
}

func (d Dog) Speak() { // Dog è‡ªå·±çš„ Speak æ–¹æ³•
    fmt.Println("Woof!")
}

// ä½¿ç”¨
dog := Dog{
    Animal: Animal{Name: "Buddy"},
    Breed:  "Golden Retriever",
}

fmt.Println(dog.Name)      // ç›´æ¥è®¿é—®åµŒå…¥å­—æ®µ (Buddy)
dog.Speak()                // è°ƒç”¨ Dog è‡ªå·±çš„æ–¹æ³• (Woof!)
dog.Animal.Speak()         // è°ƒç”¨è¢«åµŒå…¥ç±»å‹çš„æ–¹æ³• (Animal speaks)
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šGo çš„ç»„åˆä¼˜äºç»§æ‰¿çš„è®¾è®¡å“²å­¦ã€å¦‚ä½•é€šè¿‡åµŒå…¥å®ç°ä»£ç å¤ç”¨ã€æ–¹æ³•é‡å†™ï¼ˆå¤–éƒ¨ç±»å‹æ–¹æ³•ä¼šè¦†ç›–åµŒå…¥ç±»å‹åŒåæ–¹æ³•ï¼‰ã€‚

---

## âœ… 14. é”™è¯¯å¤„ç†æœºåˆ¶

### ğŸ”¢ åŸºæœ¬æ¦‚å¿µï¼š

- Go ä½¿ç”¨æ˜¾å¼çš„é”™è¯¯è¿”å›å€¼è€Œéå¼‚å¸¸æœºåˆ¶ã€‚
- é”™è¯¯ç±»å‹æ˜¯å®ç°äº† `error` æ¥å£çš„ä»»ä½•ç±»å‹ã€‚
- å‡½æ•°é€šå¸¸è¿”å› (result, error) å¯¹ã€‚

```go
type error interface {
    Error() string
}

// åŸºæœ¬ä½¿ç”¨
func readFile(path string) ([]byte, error) {
    if path == "" {
        return nil, errors.New("è·¯å¾„ä¸èƒ½ä¸ºç©º")
    }
    // è¯»å–æ–‡ä»¶...
    return data, nil
}

data, err := readFile("config.json")
if err != nil {
    log.Fatalf("è¯»å–æ–‡ä»¶å¤±è´¥: %v", err)
}
```

### ğŸ”¢ è‡ªå®šä¹‰é”™è¯¯ï¼š

```go
// è‡ªå®šä¹‰é”™è¯¯ç±»å‹
type PathError struct {
    Path    string
    Op      string
    Message string
}

func (e *PathError) Error() string {
    return fmt.Sprintf("%s %s: %s", e.Op, e.Path, e.Message)
}

// ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯
func openFile(path string) error {
    if path == "" {
        return &PathError{
            Path:    path,
            Op:      "open",
            Message: "è·¯å¾„ä¸èƒ½ä¸ºç©º",
        }
    }
    return nil
}
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šé”™è¯¯å¤„ç†æœ€ä½³å®è·µã€é”™è¯¯åŒ…è£…ï¼ˆ`fmt.Errorf("è¯»å–é…ç½®å¤±è´¥: %w", err)`ï¼‰ã€é”™è¯¯åˆ¤æ–­ï¼ˆ`errors.Is`ã€`errors.As`ï¼‰ã€‚

---

## âœ… 15. åå°„ï¼ˆReflectionï¼‰

### ğŸ”¢ åŸºæœ¬æ¦‚å¿µï¼š

- åå°„å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œä¿®æ”¹è‡ªèº«çš„ç»“æ„å’Œè¡Œä¸ºã€‚
- Go çš„åå°„ä¸»è¦é€šè¿‡ `reflect` åŒ…å®ç°ã€‚
- ä¸‰å¤§æ³•åˆ™ï¼šåå°„å¯ä»¥å°†æ¥å£å€¼è½¬æ¢ä¸ºåå°„å¯¹è±¡ï¼›åå°„å¯ä»¥å°†åå°„å¯¹è±¡è½¬æ¢ä¸ºæ¥å£å€¼ï¼›è¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œå…¶å€¼å¿…é¡»å¯è®¾ç½®ã€‚

```go
// åŸºæœ¬ä½¿ç”¨
func inspectType(x interface{}) {
    t := reflect.TypeOf(x)
    v := reflect.ValueOf(x)
    
    fmt.Printf("ç±»å‹: %v\n", t)
    fmt.Printf("å€¼: %v\n", v)
    
    if t.Kind() == reflect.Struct {
        for i := 0; i < t.NumField(); i++ {
            field := t.Field(i)
            value := v.Field(i)
            fmt.Printf("å­—æ®µ: %s, ç±»å‹: %v, å€¼: %v\n", field.Name, field.Type, value)
        }
    }
}

// ä½¿ç”¨
type Person struct {
    Name string
    Age  int
}

p := Person{"å¼ ä¸‰", 30}
inspectType(p)
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šåå°„çš„æ€§èƒ½å¼€é”€ã€ä½¿ç”¨åœºæ™¯ï¼ˆå¦‚ JSON åºåˆ—åŒ–ï¼‰ã€åå°„çš„å®‰å…¨æ€§é—®é¢˜ã€‚

---

## âœ… 16. Go è¯­è¨€çš„å¹¶å‘å®‰å…¨æ€§

### ğŸ”¢ å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ï¼š

- `sync.Map`ï¼šé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå†…éƒ¨å®ç°äº†å¹¶å‘å®‰å…¨ã€‚
- `sync.RWMutex`ï¼šè¯»å†™é”ï¼Œå…è®¸å¤šä¸ªè¯»æ“ä½œåŒæ—¶è¿›è¡Œã€‚
- `atomic` åŒ…ï¼šæä¾›åŸå­æ“ä½œï¼Œå¦‚ `atomic.AddInt64`ã€‚

```go
// sync.Map ç¤ºä¾‹
var m sync.Map

// å­˜å‚¨
m.Store("key1", "value1")
m.Store("key2", "value2")

// è¯»å–
value, ok := m.Load("key1")
if ok {
    fmt.Println(value) // value1
}

// éå†
m.Range(func(key, value interface{}) bool {
    fmt.Printf("%v: %v\n", key, value)
    return true // ç»§ç»­éå†
})
```

### ğŸ”¢ å¸¸è§çš„å¹¶å‘é™·é˜±ï¼š

- ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰
- æ­»é”ï¼ˆDeadlockï¼‰
- æ´»é”ï¼ˆLivelockï¼‰
- èµ„æºæ³„éœ²ï¼ˆå¦‚ goroutine æ³„éœ²ï¼‰

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šå¦‚ä½•é¿å…å¹¶å‘é™·é˜±ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ã€Go çš„å†…å­˜æ¨¡å‹ï¼ˆhappens-before å…³ç³»ï¼‰ã€‚

------

## âœ… 17. Go è¯­è¨€çš„åƒåœ¾å›æ”¶æœºåˆ¶

### ğŸ”¢ åŸºæœ¬åŸç†ï¼š

- Go ä½¿ç”¨å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•
- æ— åˆ†ä»£è®¾è®¡ï¼Œæ•´ä½“å›æ”¶
- å¹¶å‘æ‰§è¡Œï¼Œä¸ç”¨æˆ·ç¨‹åºåŒæ—¶è¿è¡Œ
- å†™å±éšœæŠ€æœ¯ç¡®ä¿å¹¶å‘å®‰å…¨

```go
// GC è§¦å‘æ¡ä»¶
// 1. å½“å‰åˆ†é…çš„å†…å­˜è¾¾åˆ°ä¸Šæ¬¡ GC åçš„ 2 å€
// 2. æ˜¾å¼è°ƒç”¨ runtime.GC()
// 3. å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤ 2 åˆ†é’Ÿï¼‰
```

### ğŸ”¢ ä¸‰è‰²æ ‡è®°æ³•ï¼š

- ç™½è‰²ï¼šæœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼ŒGC å¼€å§‹æ—¶æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²
- ç°è‰²ï¼šå·²è¢«æ ‡è®°ä½†å…¶å¼•ç”¨å¯¹è±¡æœªè¢«å¤„ç†çš„å¯¹è±¡
- é»‘è‰²ï¼šå·²è¢«æ ‡è®°ä¸”å…¶æ‰€æœ‰å¼•ç”¨å¯¹è±¡éƒ½å·²è¢«å¤„ç†çš„å¯¹è±¡

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šGo GC çš„ STWï¼ˆStop The Worldï¼‰æ—¶é—´éå¸¸çŸ­ï¼›Go 1.5 åå¼•å…¥äº†å¹¶å‘æ ‡è®°ï¼›Go 1.8 å STW æ—¶é—´é™è‡³äºšæ¯«ç§’çº§ã€‚

---

## âœ… 18. Go è¯­è¨€çš„å†…å­˜ç®¡ç†

### ğŸ”¢ å†…å­˜åˆ†é…ç­–ç•¥ï¼š

- å°å¯¹è±¡ï¼ˆâ‰¤32KBï¼‰ï¼šä½¿ç”¨å†…å­˜æ± åˆ†é…ï¼ŒæŒ‰å¤§å°åˆ†ä¸ºçº¦ 70 ä¸ªç±»åˆ«
- å¤§å¯¹è±¡ï¼ˆ>32KBï¼‰ï¼šç›´æ¥ä»å †ä¸Šåˆ†é…
- æå°å¯¹è±¡ï¼ˆâ‰¤16Bï¼‰ï¼šä½¿ç”¨å¾®å‹åˆ†é…å™¨ä¼˜åŒ–

```go
// å†…å­˜åˆ†é…å™¨çš„ä¸»è¦ç»„ä»¶
// mspan: ç®¡ç†å›ºå®šå¤§å°çš„å†…å­˜å—
// mcache: æ¯ä¸ª P çš„æœ¬åœ°ç¼“å­˜ï¼Œæ— é”åˆ†é…
// mcentral: æ‰€æœ‰ P å…±äº«çš„ç¼“å­˜ï¼Œæœ‰é”åˆ†é…
// mheap: ç®¡ç†ä»æ“ä½œç³»ç»Ÿç”³è¯·çš„å†…å­˜
```

### ğŸ”¢ å†…å­˜é€ƒé€¸åˆ†æï¼š

- ç¼–è¯‘å™¨å†³å®šå˜é‡åˆ†é…åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Š
- æ ˆåˆ†é…æ›´é«˜æ•ˆï¼Œä¸éœ€è¦ GC
- å¸¸è§é€ƒé€¸æƒ…å†µï¼šè¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆã€åˆ‡ç‰‡æ‰©å®¹ã€æ¥å£è½¬æ¢ç­‰

```bash
# æŸ¥çœ‹é€ƒé€¸åˆ†æç»“æœ
go build -gcflags="-m" main.go
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šå¦‚ä½•å‡å°‘å†…å­˜é€ƒé€¸ï¼›å†…å­˜åˆ†é…çš„æ€§èƒ½ä¼˜åŒ–ï¼›sync.Pool çš„ä½¿ç”¨åœºæ™¯ã€‚

---

## âœ… 19. Go è¯­è¨€çš„åç¨‹è°ƒåº¦æ¨¡å‹ï¼ˆGMPï¼‰

### ğŸ”¢ ä¸‰å¤§ç»„ä»¶ï¼š

- G (Goroutine)ï¼šç”¨æˆ·çº§çº¿ç¨‹ï¼Œè½»é‡çº§
- M (Machine)ï¼šæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œç”±ç³»ç»Ÿè°ƒåº¦
- P (Processor)ï¼šå¤„ç†å™¨ï¼Œè°ƒåº¦ä¸Šä¸‹æ–‡ï¼Œè¿æ¥ G å’Œ M

```go
// é»˜è®¤ P çš„æ•°é‡ç­‰äº GOMAXPROCS
// å¯é€šè¿‡ç¯å¢ƒå˜é‡æˆ–ä»£ç è®¾ç½®
runtime.GOMAXPROCS(4) // è®¾ç½®ä¸º 4 ä¸ª
```

### ğŸ”¢ è°ƒåº¦æµç¨‹ï¼š

- åˆ›å»º Gï¼šæ”¾å…¥ P çš„æœ¬åœ°é˜Ÿåˆ—æˆ–å…¨å±€é˜Ÿåˆ—
- è°ƒåº¦ Gï¼šP ä»æœ¬åœ°é˜Ÿåˆ—æˆ–å…¨å±€é˜Ÿåˆ—è·å– G æ‰§è¡Œ
- G é˜»å¡ï¼šM ä¼šé‡Šæ”¾ Pï¼Œç„¶åè·å–æ–°çš„ P æ‰§è¡Œå…¶ä»– G
- G å”¤é†’ï¼šæ”¾å› P çš„é˜Ÿåˆ—æˆ–å…¨å±€é˜Ÿåˆ—

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šGo 1.14 å¼•å…¥çš„æŠ¢å å¼è°ƒåº¦ï¼›å¦‚ä½•å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ goroutineï¼›ç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶çš„è°ƒåº¦ç­–ç•¥ã€‚

---

## âœ… 20. Go è¯­è¨€çš„ init å‡½æ•°

### ğŸ”¢ ç‰¹æ€§ï¼š

- æ¯ä¸ªåŒ…å¯ä»¥æœ‰å¤šä¸ª init å‡½æ•°
- åœ¨ main å‡½æ•°ä¹‹å‰è‡ªåŠ¨æ‰§è¡Œ
- æŒ‰ç…§ä¾èµ–å…³ç³»é¡ºåºæ‰§è¡Œ
- ä¸èƒ½è¢«æ˜¾å¼è°ƒç”¨

```go
// æ‰§è¡Œé¡ºåº
// 1. å¯¼å…¥åŒ…çš„å˜é‡åˆå§‹åŒ–
// 2. å¯¼å…¥åŒ…çš„ init å‡½æ•°
// 3. å½“å‰åŒ…çš„å˜é‡åˆå§‹åŒ–
// 4. å½“å‰åŒ…çš„ init å‡½æ•°
// 5. main å‡½æ•°

package main

import "fmt"

var a = func() int {
    fmt.Println("å˜é‡ a åˆå§‹åŒ–")
    return 1
}()

func init() {
    fmt.Println("init å‡½æ•° 1")
}

func init() {
    fmt.Println("init å‡½æ•° 2")
}

func main() {
    fmt.Println("main å‡½æ•°")
}

// è¾“å‡º:
// å˜é‡ a åˆå§‹åŒ–
// init å‡½æ•° 1
// init å‡½æ•° 2
// main å‡½æ•°
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šinit å‡½æ•°çš„ä½¿ç”¨åœºæ™¯ï¼ˆå¦‚é…ç½®åˆå§‹åŒ–ã€æ³¨å†Œæ¨¡å¼ï¼‰ï¼›init å‡½æ•°çš„æ‰§è¡Œé¡ºåºï¼›init å‡½æ•°çš„å‰¯ä½œç”¨ã€‚

---

## âœ… 21. Go è¯­è¨€çš„æ ‡ç­¾ä¸è·³è½¬è¯­å¥

### ğŸ”¢ åŸºæœ¬ç”¨æ³•ï¼š

- `break`ï¼šè·³å‡ºå¾ªç¯æˆ– switch
- `continue`ï¼šè·³è¿‡å½“å‰å¾ªç¯è¿­ä»£
- `goto`ï¼šæ— æ¡ä»¶è·³è½¬åˆ°æ ‡ç­¾
- `fallthrough`ï¼šåœ¨ switch ä¸­ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª case

```go
// break ä¸æ ‡ç­¾
OuterLoop:
    for i := 0; i < 5; i++ {
        for j := 0; j < 5; j++ {
            if i*j > 10 {
                break OuterLoop // è·³å‡ºå¤–å±‚å¾ªç¯
            }
        }
    }

// continue ä¸æ ‡ç­¾
OuterLoop:
    for i := 0; i < 5; i++ {
        for j := 0; j < 5; j++ {
            if j == 2 {
                continue OuterLoop // ç»§ç»­å¤–å±‚å¾ªç¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£
            }
        }
    }

// goto è¯­å¥
    if err != nil {
        goto ErrorHandler
    }
    // æ­£å¸¸å¤„ç†...
ErrorHandler:
    // é”™è¯¯å¤„ç†...
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šgoto çš„ä½¿ç”¨é™åˆ¶ï¼ˆä¸èƒ½è·³è¿‡å˜é‡å£°æ˜ï¼‰ï¼›æ ‡ç­¾çš„ä½œç”¨åŸŸï¼›fallthrough çš„ç‰¹æ®Šè¡Œä¸ºã€‚

---

## âœ… 22. Go è¯­è¨€çš„ç±»å‹æ–­è¨€ä¸ç±»å‹è½¬æ¢

### ğŸ”¢ ç±»å‹æ–­è¨€ï¼š

- ç”¨äºæ¥å£ç±»å‹ï¼Œæ£€æŸ¥æ¥å£å€¼çš„åŠ¨æ€ç±»å‹
- è¯­æ³•ï¼š`value, ok := x.(T)`

```go
var i interface{} = "hello"

// å¸¦æ£€æŸ¥çš„ç±»å‹æ–­è¨€
s, ok := i.(string)
if ok {
    fmt.Println(s) // hello
}

// ä¸å¸¦æ£€æŸ¥çš„ç±»å‹æ–­è¨€ï¼ˆå¤±è´¥ä¼š panicï¼‰
s := i.(string) // hello

// ç±»å‹æ–­è¨€å¤±è´¥
n, ok := i.(int)
fmt.Println(n, ok) // 0 false
```

### ğŸ”¢ ç±»å‹è½¬æ¢ï¼š

- ç”¨äºå…¼å®¹ç±»å‹ä¹‹é—´çš„è½¬æ¢
- è¯­æ³•ï¼š`T(x)`

```go
var i int = 42
var f float64 = float64(i)
var u uint = uint(f)

// å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡è½¬æ¢
s := "hello"
b := []byte(s)
s2 := string(b)
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šç±»å‹æ–­è¨€ä¸ç±»å‹è½¬æ¢çš„åŒºåˆ«ï¼›ç±»å‹æ–­è¨€çš„å®‰å…¨ä½¿ç”¨ï¼›ç±»å‹è½¬æ¢çš„æ€§èƒ½å¼€é”€ã€‚

---

## âœ… 23. Go è¯­è¨€çš„ select è¯­å¥

### ğŸ”¢ åŸºæœ¬ç”¨æ³•ï¼š

- ç”¨äºå¤šé€šé“æ“ä½œ
- éšæœºé€‰æ‹©ä¸€ä¸ªå¯æ‰§è¡Œçš„ case
- å¦‚æœå¤šä¸ª case å°±ç»ªï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª
- å¦‚æœæ²¡æœ‰ case å°±ç»ªï¼Œé˜»å¡æˆ–æ‰§è¡Œ default

```go
select {
case msg1 := <-ch1:
    fmt.Println("æ¥æ”¶åˆ°æ¥è‡ª ch1 çš„æ¶ˆæ¯:", msg1)
case msg2 := <-ch2:
    fmt.Println("æ¥æ”¶åˆ°æ¥è‡ª ch2 çš„æ¶ˆæ¯:", msg2)
case ch3 <- msg3:
    fmt.Println("å‘é€æ¶ˆæ¯åˆ° ch3")
case <-time.After(1 * time.Second):
    fmt.Println("è¶…æ—¶")
default:
    fmt.Println("æ²¡æœ‰é€šé“æ“ä½œå°±ç»ª")
}
```

### ğŸ”¢ å¸¸è§æ¨¡å¼ï¼š

```go
// éé˜»å¡æ¥æ”¶
select {
case x := <-ch:
    // ä½¿ç”¨ x
default:
    // é€šé“æ²¡æœ‰å€¼ï¼Œæ‰§è¡Œå…¶ä»–æ“ä½œ
}

// è¶…æ—¶æ§åˆ¶
select {
case <-ch:
    // æˆåŠŸæ¥æ”¶
case <-time.After(1 * time.Second):
    // è¶…æ—¶å¤„ç†
}

// ä¼˜é›…é€€å‡º
for {
    select {
    case <-done:
        return
    case x := <-ch:
        // å¤„ç† x
    }
}
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šselect çš„éšæœºé€‰æ‹©æœºåˆ¶ï¼›ç©º select è¯­å¥ä¼šæ°¸ä¹…é˜»å¡ï¼›select ä¸ for å¾ªç¯ç»“åˆçš„å¸¸è§æ¨¡å¼ã€‚

---

## âœ… 24. Go è¯­è¨€çš„ unsafe åŒ…

### ğŸ”¢ åŸºæœ¬åŠŸèƒ½ï¼š

- ç»•è¿‡ Go çš„ç±»å‹ç³»ç»Ÿï¼Œç›´æ¥æ“ä½œå†…å­˜
- æä¾›æŒ‡é’ˆç±»å‹è½¬æ¢å’Œå†…å­˜å¸ƒå±€æ“ä½œ
- ä¸ä¿è¯å‘åå…¼å®¹æ€§å’Œè·¨å¹³å°ä¸€è‡´æ€§

```go
// ä¸»è¦ç±»å‹å’Œå‡½æ•°
type Pointer uintptr // é€šç”¨æŒ‡é’ˆç±»å‹
func Sizeof(x ArbitraryType) uintptr // è¿”å›ç±»å‹å ç”¨çš„å­—èŠ‚æ•°
func Alignof(x ArbitraryType) uintptr // è¿”å›ç±»å‹çš„å¯¹é½è¦æ±‚
func Offsetof(x ArbitraryType) uintptr // è¿”å›ç»“æ„ä½“å­—æ®µçš„åç§»é‡
```

### ğŸ”¢ å¸¸è§ç”¨é€”ï¼š

```go
// ç±»å‹è½¬æ¢
func Float64bits(f float64) uint64 {
    return *(*uint64)(unsafe.Pointer(&f))
}

// è®¿é—®ç»“æ„ä½“çš„æœªå¯¼å‡ºå­—æ®µ
type T struct {
    a int
    b int
}

t := T{23, 42}
p := unsafe.Pointer(&t)
pb := (*int)(unsafe.Pointer(uintptr(p) + unsafe.Offsetof(t.b)))
*pb = 99 // ä¿®æ”¹ t.b
```

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šunsafe çš„ä½¿ç”¨é£é™©ï¼›ä½•æ—¶åº”è¯¥ä½¿ç”¨ unsafeï¼›ä½¿ç”¨ unsafe çš„æœ€ä½³å®è·µã€‚

---

## âœ… 25. Go è¯­è¨€çš„ cgo

### ğŸ”¢ åŸºæœ¬æ¦‚å¿µï¼š

- å…è®¸ Go ä»£ç è°ƒç”¨ C ä»£ç 
- ä½¿ç”¨ç‰¹æ®Šçš„æ³¨é‡Šå— `// #cgo` å’Œ `// #include`
- ç¼–è¯‘æ—¶ä¼šç”Ÿæˆæ¡¥æ¥ä»£ç 

```go
// #include <stdio.h>
// #include <stdlib.h>
//
// void printMessage(const char* message) {
//     printf("%s\n", message);
// }
//
// #cgo CFLAGS: -I.
// #cgo LDFLAGS: -L. -lmylib
import "C"
import "unsafe"

func main() {
    message := C.CString("Hello from Go!")
    defer C.free(unsafe.Pointer(message))
    C.printMessage(message)
}
```

### ğŸ”¢ ç±»å‹æ˜ å°„ï¼š

| Go ç±»å‹  | C ç±»å‹ |
| -------- | ------ |
| C.char   | char   |
| C.int    | int    |
| C.float  | float  |
| C.double | double |
| *C.char  | char*  |

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šcgo çš„æ€§èƒ½å¼€é”€ï¼›å†…å­˜ç®¡ç†æ³¨æ„äº‹é¡¹ï¼›è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜ã€‚

---

## âœ… 26. Go è¯­è¨€çš„ context åŒ…

### ğŸ”¢ åŸºæœ¬æ¦‚å¿µï¼š

- ç”¨äºè·¨ API è¾¹ç•Œå’Œè¿›ç¨‹é—´ä¼ é€’æˆªæ­¢æ—¶é—´ã€å–æ¶ˆä¿¡å·å’Œè¯·æ±‚ä½œç”¨åŸŸçš„å€¼
- åœ¨ goroutine ä¹‹é—´ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯
- æ”¯æŒå–æ¶ˆæ“ä½œå’Œè¶…æ—¶æ§åˆ¶

```go
// åˆ›å»ºæ ¹ context
ctx := context.Background() // ç©º contextï¼Œæ°¸ä¸å–æ¶ˆ
ctx := context.TODO()       // ä¸´æ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºå°†æ¥ä¼šæ·»åŠ å…·ä½“ context

// æ´¾ç”Ÿ context
ctx, cancel := context.WithCancel(parentCtx)
ctx, cancel := context.WithTimeout(parentCtx, 5*time.Second)
ctx, cancel := context.WithDeadline(parentCtx, time.Now().Add(5*time.Second))
ctx = context.WithValue(parentCtx, key, value)

// ä½¿ç”¨ context
select {
case <-ctx.Done():
    err := ctx.Err() // context.Canceled æˆ– context.DeadlineExceeded
    return err
case <-time.After(1 * time.Second):
    // ç»§ç»­æ‰§è¡Œ
}
```

### ğŸ”¢ æœ€ä½³å®è·µï¼š

- å‡½æ•°åº”æ¥å— context ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°
- ä¸è¦å°† nil ä½œä¸º context å‚æ•°ä¼ é€’
- context.Value åªç”¨äºè¯·æ±‚ä½œç”¨åŸŸçš„æ•°æ®ï¼Œä¸ç”¨äºä¼ é€’å¯é€‰å‚æ•°
- æ´¾ç”Ÿçš„ context åº”è¯¥ä¼ é€’ç»™ä¸‹æ¸¸å‡½æ•°è°ƒç”¨

> ğŸ’¡ é¢è¯•é‡ç‚¹ï¼šcontext çš„ä¼ æ’­æœºåˆ¶ï¼›context.Value çš„æ€§èƒ½å½±å“ï¼›context çš„å–æ¶ˆä¼ æ’­ç‰¹æ€§ã€‚

---



# ğŸ” äºŒã€å¹¶å‘ç¼–ç¨‹æ·±åº¦å‰–æ

## âœ… 1. Goroutine ç”Ÿå‘½å‘¨æœŸç®¡ç†

### å¯åŠ¨æ–¹å¼ï¼š

```go
go func() {
    // do something
}()
```

### åº•å±‚æœºåˆ¶ï¼š

- æ¯ä¸ª goroutine éƒ½æœ‰ä¸€ä¸ª G ç»“æ„ä½“ï¼ˆruntime.gï¼‰
- åˆå§‹æ ˆå¤§å°ä¸º 2KBï¼Œå¯åŠ¨æ€å¢é•¿
- Mï¼ˆmachineï¼‰ä»£è¡¨çº¿ç¨‹ï¼ŒPï¼ˆprocessorï¼‰è´Ÿè´£è°ƒåº¦ G åˆ° M ä¸Šè¿è¡Œ

> é¢è¯•é‡ç‚¹ï¼šgoroutine æ³„æ¼çš„å¸¸è§åŸå› åŠæ’æŸ¥æ‰‹æ®µ

---

## âœ… 2. Channel çš„å®ç°åŸç†ï¼ˆå«æºç åˆ†æï¼‰

Go çš„ channel æ˜¯é€šè¿‡ runtime å®ç°çš„ï¼Œå…¶åº•å±‚ç»“æ„å¦‚ä¸‹ï¼š

```c
struct Hchan {
    uintgo qcount;          // å½“å‰å…ƒç´ æ•°é‡
    uintgo dataqsiz;        // ç¯å½¢ç¼“å†²åŒºå¤§å°
    uint16 elemalign;
    bool closed;
    Elem* elemsize;         // å…ƒç´ å¤§å°
    void* qptra;            // é˜Ÿåˆ—å¤´éƒ¨æŒ‡é’ˆ
    WaitQ recvq;             // æ¥æ”¶è€…ç­‰å¾…é˜Ÿåˆ—
    WaitQ sendq;             // å‘é€è€…ç­‰å¾…é˜Ÿåˆ—
};
```

### åˆ†ç±»ï¼š

| ç±»å‹     | ç‰¹ç‚¹                             |
| -------- | -------------------------------- |
| æ— ç¼“å†²   | å¿…é¡» sender å’Œ receiver åŒæ—¶å°±ç»ª |
| æœ‰ç¼“å†²   | åªæœ‰å½“ç¼“å†²åŒºæ»¡æ—¶å‘é€æ–¹æ‰ä¼šé˜»å¡   |
| å•å‘é€šé“ | `chan<- T` / `<-chan T`          |

> é¢è¯•é‡ç‚¹ï¼šchannel æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿç­”ï¼šå–å†³äºæ˜¯å¦å¸¦ç¼“å†²ã€‚

---

## âœ… 3. Context çš„ä½œç”¨ä¸ä¼ æ’­æœºåˆ¶

### Context çš„ç»§æ‰¿å…³ç³»ï¼š

```go
ctx, cancel := context.WithCancel(context.Background())
```

- `Background()` æ˜¯æ ¹ context
- `WithCancel()` è¿”å›ä¸€ä¸ªæ–°çš„ contextï¼Œå¹¶æä¾› cancel å‡½æ•°
- å­ context ä¼šç»§æ‰¿çˆ¶ context çš„ deadlineã€value ç­‰ä¿¡æ¯

### åº”ç”¨åœºæ™¯ï¼š

- æ§åˆ¶ goroutine ç”Ÿå‘½å‘¨æœŸ
- ä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ˆå¦‚ trace_idï¼‰
- å®ç°è¶…æ—¶æ§åˆ¶

> é¢è¯•é«˜é¢‘é—®é¢˜ï¼šcontext.Value() çš„æ€§èƒ½å½±å“ï¼Ÿç­”ï¼šæŸ¥æ‰¾é“¾å¼ parentï¼Œåº”é¿å…é¢‘ç¹è°ƒç”¨ã€‚

---

## âœ… 4. sync.WaitGroup vs errgroup.Group

| åç§°           | ç‰¹ç‚¹                                          |
| -------------- | --------------------------------------------- |
| WaitGroup      | ç­‰å¾…æ‰€æœ‰ goroutine å®Œæˆï¼Œä¸æ”¯æŒé”™è¯¯ä¼ æ’­       |
| errgroup.Group | æ”¯æŒé”™è¯¯ä¼ æ’­ï¼Œç¬¬ä¸€ä¸ª error ä¼š cancel å…¶ä»–ä»»åŠ¡ |

```go
g, _ := errgroup.WithContext(ctx)
for _, url := range urls {
    url := url
    g.Go(func() error {
        resp, err := http.Get(url)
        if err != nil {
            return err
        }
        resp.Body.Close()
        return nil
    })
}
err := g.Wait()
```

> é¢è¯•å»ºè®®ï¼šåœ¨éœ€è¦é”™è¯¯å¤„ç†æˆ–å–æ¶ˆçš„åœºæ™¯ä¸­ä¼˜å…ˆä½¿ç”¨ errgroupã€‚

---

## âœ… 5. Mutex é”æœºåˆ¶ä¸ç«æ€æ£€æµ‹

Go æä¾›äº†ä»¥ä¸‹é”æœºåˆ¶ï¼š

| ç±»å‹    | ç‰¹ç‚¹                           |
| ------- | ------------------------------ |
| Mutex   | æ™®é€šäº’æ–¥é”                     |
| RWMutex | æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Œé€‚åˆè¯»å¤šå†™å°‘     |
| Once    | ä¿è¯åˆå§‹åŒ–åªæ‰§è¡Œä¸€æ¬¡           |
| Cond    | æ¡ä»¶å˜é‡ï¼Œç”¨äºç­‰å¾…ç‰¹å®šæ¡ä»¶æˆç«‹ |

> ä½¿ç”¨æŠ€å·§ï¼šå°½é‡é¿å…é”ï¼Œä¼˜å…ˆä½¿ç”¨ channel é€šä¿¡ã€‚

### ç«æ€æ£€æµ‹å·¥å…·ï¼š

```bash
go run -race main.go
```

---

# ğŸš€ ä¸‰ã€æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•å·¥å…·

## âœ… 1. pprof æ€§èƒ½åˆ†æè¯¦è§£

å¯åŠ¨ HTTP æ¥å£ï¼š

```go
import _ "net/http/pprof"
go func() {
    http.ListenAndServe(":6060", nil)
}()
```

è®¿é—®åœ°å€ï¼š

```
http://localhost:6060/debug/pprof/
```

å¸¸ç”¨å‘½ä»¤ï¼š

| ç±»å‹     | å‘½ä»¤                                                         |
| -------- | ------------------------------------------------------------ |
| CPU åˆ†æ | `go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30` |
| å†…å­˜åˆ†æ | `go tool pprof http://localhost:6060/debug/pprof/heap`       |
| åç¨‹åˆ†æ | `go tool pprof http://localhost:6060/debug/pprof/goroutine`  |

---

## âœ… 2. sync.Pool å¯¹è±¡å¤ç”¨æœºåˆ¶

é€‚ç”¨äºä¸´æ—¶å¯¹è±¡ç¼“å­˜ï¼Œé™ä½ GC å‹åŠ›ï¼š

```go
var pool = sync.Pool{
    New: func() interface{} {
        return &MyObject{}
    },
}

obj := pool.Get().(*MyObject)
// use obj
pool.Put(obj)
```

> æ³¨æ„äº‹é¡¹ï¼šsync.Pool ä¸ä¿è¯ Put çš„å¯¹è±¡ä¸€å®šè¢«ä¿ç•™ï¼ˆGC å¯å›æ”¶ï¼‰ï¼Œé€‚åˆéå…³é”®æ€§å¯¹è±¡ã€‚

---

## âœ… 3. å‡å°‘å†…å­˜é€ƒé€¸

### æŸ¥çœ‹é€ƒé€¸æƒ…å†µï¼š

```bash
go build -gcflags="-m" main.go
```

### å¸¸è§é€ƒé€¸åŸå› ï¼š

- è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆ
- interface{} å‚æ•°
- é—­åŒ…æ•è·å¤§ç»“æ„ä½“

> é¢è¯•å»ºè®®ï¼šå°½å¯èƒ½è®©å¯¹è±¡åˆ†é…åœ¨æ ˆä¸Šï¼Œå‡å°‘å †åˆ†é…å‹åŠ›ã€‚

---

# ğŸ› ï¸ å››ã€æ ‡å‡†åº“ä¸å·¥ç¨‹å®è·µ

## âœ… 1. net/http è¯·æ±‚ç”Ÿå‘½å‘¨æœŸè¯¦è§£

```go
http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hello World")
})
http.ListenAndServe(":8080", nil)
```

### åº•å±‚æµç¨‹ï¼š

1. ç›‘å¬ socket
2. æ¥æ”¶åˆ°è¯·æ±‚ååˆ›å»ºæ–°çš„ goroutine å¤„ç†
3. æ„é€  request å’Œ response writer
4. è°ƒç”¨æ³¨å†Œçš„ handler
5. è¿”å›å“åº”

> é¢è¯•é‡ç‚¹ï¼šHTTP server å¦‚ä½•åšåˆ°é«˜å¹¶å‘ï¼Ÿç­”ï¼šæ¯ä¸ªè¿æ¥ä¸€ä¸ª goroutineï¼ŒåŸºäº netpoller éé˜»å¡ I/Oã€‚

---

## âœ… 2. encoding/json ç¼–è§£ç åŸç†

- ä½¿ç”¨åå°„è§£æç»“æ„ä½“ tag
- æ”¯æŒ Marshal/Unmarshal
- æ”¯æŒæµå¼ç¼–è§£ç ï¼ˆDecoder/Encoderï¼‰

```go
type User struct {
    Name string `json:"name"`
    Age  int    `json:"age,omitempty"`
}
```

> é¢è¯•é«˜é¢‘é—®é¢˜ï¼šJSON tag ä¸­çš„ omitempty æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç­”ï¼šå¦‚æœå­—æ®µä¸ºç©ºï¼ˆé›¶å€¼ï¼‰ï¼Œåˆ™å¿½ç•¥è¯¥å­—æ®µã€‚

---

## âœ… 3. database/sql æ•°æ®åº“æŠ½è±¡å±‚

Go çš„ database/sql æ˜¯æ•°æ®åº“é©±åŠ¨çš„æ ‡å‡†æ¥å£ï¼Œå®é™…æ“ä½œéœ€å¼•å…¥é©±åŠ¨ï¼š

```go
import (
    _ "github.com/go-sql-driver/mysql"
)

db, err := sql.Open("mysql", "user:pass@tcp(127.0.0.1:3306)/dbname")
rows, err := db.Query("SELECT name FROM users")
```

> é¢è¯•é‡ç‚¹ï¼šsql.DB æ˜¯è¿æ¥æ± å—ï¼Ÿç­”ï¼šæ˜¯çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿æ¥æ± æŠ½è±¡ï¼Œä¸æ˜¯å•ä¸ªè¿æ¥ã€‚

---

# ğŸ“š äº”ã€é«˜é¢‘çœŸé¢˜ç²¾é€‰ï¼ˆé™„è¯¦ç»†è§£æï¼‰

### Q1: Go çš„åƒåœ¾å›æ”¶æœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•ï¼ˆé»‘ç™½ç°ï¼‰
> - å¹¶å‘æ ‡è®°æ¸…é™¤ï¼ˆCMSï¼‰
> - å†™å±éšœä¿è¯ä¸€è‡´æ€§
> - STW æ—¶é—´æçŸ­ï¼ˆå°äº 1msï¼‰
> - æ”¯æŒå¢é‡å¼ GCï¼ˆGo 1.19+ï¼‰

---

### Q2: å¦‚ä½•é«˜æ•ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ `strings.Builder`
> - é¿å… `s += "abc"`ï¼ˆæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼‰
> - Builder å†…éƒ¨ä½¿ç”¨ `[]byte` ç¼“å†²ï¼Œappend æ—¶è‡ªåŠ¨æ‰©å®¹

---

### Q3: select çš„éšæœºé€‰æ‹©æœºåˆ¶ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - select ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ case æ‰§è¡Œ
> - å¦‚æœå¤šä¸ª channel å°±ç»ªï¼Œä¸ä¼šæ€»æ˜¯é€‰ç¬¬ä¸€ä¸ª
> - è¿™æ˜¯ä¸ºäº†é˜²æ­¢é¥¥é¥¿é—®é¢˜

---

### Q4: map æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - map ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
> - éœ€è¦åŠ é”ï¼ˆå¦‚ sync.Mutexï¼‰
> - æˆ–ä½¿ç”¨ sync.Mapï¼ˆé€‚ç”¨äºè¯»å¤šå†™å°‘åœºæ™¯ï¼‰

---

### Q5: å¦‚ä½•å®ç°ä¸€ä¸ª worker poolï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ channel æ§åˆ¶ä»»åŠ¡åˆ†å‘
> - åˆ›å»ºå›ºå®šæ•°é‡çš„ goroutine æ¶ˆè´¹ channel
> - é€šè¿‡å…³é—­ channel æ§åˆ¶é€€å‡º

ç¤ºä¾‹ï¼š

```go
jobs := make(chan int, 100)
done := make(chan bool)

for w := 0; w < 3; w++ {
    go func() {
        for job := range jobs {
            fmt.Println("Processing job:", job)
        }
        done <- true
    }()
}

for j := 0; j < 5; j++ {
    jobs <- j
}
close(jobs)

for i := 0; i < 3; i++ {
    <-done
}
```

---

### Q6: å¦‚ä½•ç†è§£ Go ä¸­çš„ defer æ‰§è¡Œé¡ºåºï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - defer è¯­å¥æŒ‰ç…§ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰é¡ºåºæ‰§è¡Œ
> - æ¯ä¸ª defer è¯­å¥åœ¨æ³¨å†Œæ—¶ä¼šä¿å­˜å½“å‰çš„å‡½æ•°çŠ¶æ€ï¼ˆåŒ…æ‹¬å‚æ•°å€¼ï¼‰
> - å¦‚æœ defer ä¸­ä½¿ç”¨çš„æ˜¯åŒ¿åå‡½æ•°ï¼Œåˆ™å¯ä»¥æ•è·å¤–éƒ¨å˜é‡çš„æœ€ç»ˆå€¼
> - defer åœ¨ panic å’Œ return ä¹‹åï¼Œå‡½æ•°è¿”å›ä¹‹å‰æ‰§è¡Œ
> - Go 1.14 åï¼Œdefer çš„æ€§èƒ½å¾—åˆ°æ˜¾è‘—æå‡ï¼ˆå†…è”ä¼˜åŒ–ï¼‰

ç¤ºä¾‹ï¼š
```go
func deferDemo() {
    i := 1
    defer fmt.Println("defer 1, i =", i) // è¾“å‡º: defer 1, i = 1
    i++
    defer fmt.Println("defer 2, i =", i) // è¾“å‡º: defer 2, i = 2
    i++
    defer func() {
        fmt.Println("defer 3, i =", i) // è¾“å‡º: defer 3, i = 3
    }()
}
// æ‰§è¡Œé¡ºåº: defer 3, i = 3 -> defer 2, i = 2 -> defer 1, i = 1
```

---

### Q7: Go ä¸­çš„ nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - nil åˆ‡ç‰‡ï¼š`var s []int`ï¼Œå…¶å€¼ä¸º nilï¼Œé•¿åº¦å’Œå®¹é‡éƒ½ä¸º 0
> - ç©ºåˆ‡ç‰‡ï¼š`s := []int{}`ï¼Œå…¶å€¼ä¸ä¸º nilï¼Œé•¿åº¦å’Œå®¹é‡éƒ½ä¸º 0
> - ä¸¤è€…åœ¨åŠŸèƒ½ä¸Šå‡ ä¹ç­‰ä»·ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ append
> - åœ¨åºåˆ—åŒ–ä¸º JSON æ—¶ï¼Œnil åˆ‡ç‰‡ä¼šå˜æˆ nullï¼Œç©ºåˆ‡ç‰‡ä¼šå˜æˆ []
> - åœ¨ä¸ nil æ¯”è¾ƒæ—¶ï¼Œnil åˆ‡ç‰‡ç­‰äº nilï¼Œç©ºåˆ‡ç‰‡ä¸ç­‰äº nil

ç¤ºä¾‹ï¼š
```go
var nilSlice []int
emptySlice := []int{}

fmt.Println(nilSlice == nil)  // true
fmt.Println(emptySlice == nil) // false

fmt.Println(len(nilSlice), cap(nilSlice))   // 0 0
fmt.Println(len(emptySlice), cap(emptySlice)) // 0 0

// ä¸¤è€…éƒ½å¯ä»¥ç›´æ¥ append
nilSlice = append(nilSlice, 1)
emptySlice = append(emptySlice, 1)
```

---

### Q8: å¦‚ä½•å®ç° Go çš„é”™è¯¯å¤„ç†æœ€ä½³å®è·µï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - é”™è¯¯åº”è¯¥æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªè¿”å›å€¼
> - ä½¿ç”¨ `errors.New` æˆ– `fmt.Errorf` åˆ›å»ºç®€å•é”™è¯¯
> - è‡ªå®šä¹‰é”™è¯¯ç±»å‹åº”å®ç° `error` æ¥å£
> - Go 1.13 åï¼Œä½¿ç”¨ `%w` åŒ…è£…é”™è¯¯ï¼Œé…åˆ `errors.Is` å’Œ `errors.As` æ£€æŸ¥
> - é¿å…è¿‡åº¦ä½¿ç”¨ panicï¼Œä»…ç”¨äºä¸å¯æ¢å¤çš„é”™è¯¯
> - åœ¨å¤„ç†é”™è¯¯æ—¶ï¼Œè¦ä¹ˆå®Œå…¨å¤„ç†ï¼Œè¦ä¹ˆå‘ä¸Šä¼ æ’­ï¼ˆä¸è¦å¿½ç•¥ï¼‰

ç¤ºä¾‹ï¼š
```go
// é”™è¯¯åŒ…è£…
if err := doSomething(); err != nil {
    return fmt.Errorf("å¤„ç†ä»»åŠ¡å¤±è´¥: %w", err)
}

// é”™è¯¯æ£€æŸ¥
var pathError *os.PathError
if errors.As(err, &pathError) {
    fmt.Println("è·¯å¾„é”™è¯¯:", pathError.Path)
}

if errors.Is(err, os.ErrNotExist) {
    fmt.Println("æ–‡ä»¶ä¸å­˜åœ¨")
}
```

---

### Q9: Go ä¸­çš„ channel å…³é—­åè¯»å†™ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - å‘å·²å…³é—­çš„ channel å†™å…¥æ•°æ®ä¼šå¯¼è‡´ panic
> - ä»å·²å…³é—­çš„ channel è¯»å–æ•°æ®ä¼šè¿”å›é›¶å€¼å’Œ false çš„ ok å€¼
> - é‡å¤å…³é—­ channel ä¼šå¯¼è‡´ panic
> - å…³é—­ nil channel ä¼šå¯¼è‡´ panic
> - ä»å·²å…³é—­ä½†æœ‰ç¼“å†²æ•°æ®çš„ channel è¯»å–ï¼Œä¼šå…ˆè¯»å®Œç¼“å†²åŒºæ•°æ®ï¼Œå†è¿”å›é›¶å€¼

ç¤ºä¾‹ï¼š
```go
ch := make(chan int, 2)
ch <- 1
ch <- 2
close(ch)

// è¯»å–å·²å…³é—­ä½†æœ‰æ•°æ®çš„ channel
v1, ok1 := <-ch  // v1 = 1, ok1 = true
v2, ok2 := <-ch  // v2 = 2, ok2 = true
v3, ok3 := <-ch  // v3 = 0, ok3 = false

// å‘å·²å…³é—­çš„ channel å†™å…¥ä¼š panic
// ch <- 3  // panic: send on closed channel

// é‡å¤å…³é—­ä¼š panic
// close(ch)  // panic: close of closed channel
```

---

### Q10: å¦‚ä½•å¤„ç† Go ä¸­çš„è¶…æ—¶é—®é¢˜ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ `context.WithTimeout` æˆ– `context.WithDeadline` åˆ›å»ºè¶…æ—¶ä¸Šä¸‹æ–‡
> - ä½¿ç”¨ `time.After` é…åˆ select å®ç°è¶…æ—¶æ§åˆ¶
> - ä½¿ç”¨ `time.NewTimer` åˆ›å»ºå®šæ—¶å™¨ï¼Œå¯é‡ç½®å’Œåœæ­¢
> - åœ¨ HTTP å®¢æˆ·ç«¯ä¸­è®¾ç½® `http.Client.Timeout`
> - åœ¨æ•°æ®åº“æ“ä½œä¸­ä½¿ç”¨å¸¦è¶…æ—¶çš„ä¸Šä¸‹æ–‡

ç¤ºä¾‹ï¼š
```go
// ä½¿ç”¨ context å®ç°è¶…æ—¶
ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)
defer cancel()

select {
case <-time.After(1 * time.Second):
    fmt.Println("æ“ä½œè€—æ—¶è¿‡é•¿")
case result := <-doAsyncOperation():
    fmt.Println("æ“ä½œå®Œæˆ:", result)
}

// HTTP å®¢æˆ·ç«¯è¶…æ—¶
client := &http.Client{
    Timeout: 5 * time.Second,
}
resp, err := client.Get("https://example.com")
```

---

### Q11: Go ä¸­å¦‚ä½•å®ç°å¹¶å‘å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ `sync.Once` ç¡®ä¿åˆå§‹åŒ–åªæ‰§è¡Œä¸€æ¬¡
> - ä½¿ç”¨åŒ…çº§å˜é‡å’Œ init å‡½æ•°ï¼ˆç®€å•ä½†ä¸çµæ´»ï¼‰
> - ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šï¼ˆä¸æ¨èï¼ŒGo æœ‰æ›´å¥½çš„æ–¹å¼ï¼‰
> - ä½¿ç”¨åŸå­æ“ä½œç¡®ä¿å¯è§æ€§
> - ä½¿ç”¨ `sync.Mutex` ä¿æŠ¤å…±äº«èµ„æº

ç¤ºä¾‹ï¼š
```go
type Singleton struct {
    // å­—æ®µ
}

var (
    instance *Singleton
    once     sync.Once
)

func GetInstance() *Singleton {
    once.Do(func() {
        instance = &Singleton{}
        // åˆå§‹åŒ–
    })
    return instance
}
```

---

### Q12: å¦‚ä½•ä¼˜åŒ– Go ç¨‹åºçš„æ€§èƒ½ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ pprof è¿›è¡Œæ€§èƒ½åˆ†æï¼ˆCPUã€å†…å­˜ã€é˜»å¡åˆ†æï¼‰
> - å‡å°‘å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶å‹åŠ›
> - ä½¿ç”¨ `sync.Pool` å¤ç”¨å¯¹è±¡
> - é¿å…ä¸å¿…è¦çš„åå°„å’Œæ¥å£è½¬æ¢
> - ä½¿ç”¨é€‚å½“çš„æ•°æ®ç»“æ„å’Œç®—æ³•
> - åˆç†è®¾ç½® GOMAXPROCS
> - é¿å… goroutine æ³„æ¼
> - ä½¿ç”¨ `strings.Builder` è€Œé `+` æ‹¼æ¥å­—ç¬¦ä¸²

ç¤ºä¾‹ï¼š
```go
// ä½¿ç”¨ sync.Pool å¤ç”¨å¯¹è±¡
var bufferPool = sync.Pool{
    New: func() interface{} {
        return new(bytes.Buffer)
    },
}

func processRequest() {
    buf := bufferPool.Get().(*bytes.Buffer)
    buf.Reset()
    defer bufferPool.Put(buf)
    
    // ä½¿ç”¨ buf å¤„ç†è¯·æ±‚
}
```

---

### Q13: Go ä¸­çš„ interface{} å’Œ any æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - `any` æ˜¯ Go 1.18 å¼•å…¥çš„ `interface{}` çš„ç±»å‹åˆ«å
> - ä¸¤è€…åœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šå®Œå…¨ç›¸åŒ
> - `any` æä¾›äº†æ›´ç®€æ´ã€æ›´ç›´è§‚çš„è¯­æ³•
> - åœ¨æ–°ä»£ç ä¸­æ¨èä½¿ç”¨ `any`
> - åœ¨æ³›å‹çº¦æŸä¸­ï¼Œ`any` æ›´ä¸ºå¸¸ç”¨

ç¤ºä¾‹ï¼š
```go
// ä½¿ç”¨ interface{}
func PrintOld(v interface{}) {
    fmt.Println(v)
}

// ä½¿ç”¨ any
func PrintNew(v any) {
    fmt.Println(v)
}

// åœ¨æ³›å‹ä¸­ä½¿ç”¨
func Map[T any, U any](s []T, f func(T) U) []U {
    r := make([]U, len(s))
    for i, v := range s {
        r[i] = f(v)
    }
    return r
}
```

---

### Q14: å¦‚ä½•åœ¨ Go ä¸­å¤„ç†å¹¶å‘æ•°æ®åº“è¿æ¥ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨è¿æ¥æ± ï¼ˆ`sql.DB` å†…ç½®äº†è¿æ¥æ± ï¼‰
> - è®¾ç½®æœ€å¤§è¿æ¥æ•°ï¼ˆ`SetMaxOpenConns`ï¼‰
> - è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼ˆ`SetMaxIdleConns`ï¼‰
> - è®¾ç½®è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆ`SetConnMaxLifetime`ï¼‰
> - ä½¿ç”¨ context æ§åˆ¶æŸ¥è¯¢è¶…æ—¶
> - é¿å…åœ¨äº‹åŠ¡ä¸­é•¿æ—¶é—´æŒæœ‰è¿æ¥
> - ä½¿ç”¨ prepared statement æé«˜æ€§èƒ½

ç¤ºä¾‹ï¼š
```go
db, err := sql.Open("mysql", "user:password@tcp(127.0.0.1:3306)/dbname")
if err != nil {
    log.Fatal(err)
}

// é…ç½®è¿æ¥æ± 
db.SetMaxOpenConns(25)
db.SetMaxIdleConns(25)
db.SetConnMaxLifetime(5 * time.Minute)

// ä½¿ç”¨ context æ§åˆ¶è¶…æ—¶
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()

rows, err := db.QueryContext(ctx, "SELECT * FROM users WHERE id = ?", id)
```

---

### Q15: Go ä¸­çš„ sync.Map å’Œæ™®é€š map æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - `sync.Map` æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ™®é€š map ä¸æ˜¯
> - `sync.Map` é’ˆå¯¹è¯»å¤šå†™å°‘çš„åœºæ™¯ä¼˜åŒ–
> - `sync.Map` ä¸éœ€è¦åƒæ™®é€š map ä¸€æ ·ä½¿ç”¨äº’æ–¥é”
> - `sync.Map` çš„ API ä¸æ™®é€š map ä¸åŒï¼ˆLoad/Store/Delete/Rangeï¼‰
> - `sync.Map` å†…éƒ¨ä½¿ç”¨äº†è¯»å†™åˆ†ç¦»å’ŒåŸå­æ“ä½œä¼˜åŒ–æ€§èƒ½
> - æ™®é€š map åœ¨å¹¶å‘å†™å…¥æ—¶ä¼šè§¦å‘ panic

ç¤ºä¾‹ï¼š
```go
// æ™®é€š map éœ€è¦äº’æ–¥é”ä¿æŠ¤
var m = make(map[string]int)
var mutex sync.Mutex

func increment(key string) {
    mutex.Lock()
    defer mutex.Unlock()
    m[key]++
}

// sync.Map ä¸éœ€è¦é¢å¤–çš„é”
var syncMap sync.Map

func incrementSafe(key string) {
    value, _ := syncMap.LoadOrStore(key, 0)
    syncMap.Store(key, value.(int)+1)
}
```

---

### Q16: å¦‚ä½•åœ¨ Go ä¸­å®ç°ä¼˜é›…å…³é—­ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - æ•è·ç³»ç»Ÿä¿¡å·ï¼ˆå¦‚ SIGINT, SIGTERMï¼‰
> - ä½¿ç”¨ context å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„æ“ä½œ
> - å…³é—­æ‰€æœ‰æ‰“å¼€çš„èµ„æºï¼ˆæ•°æ®åº“è¿æ¥ã€æ–‡ä»¶ç­‰ï¼‰
> - ç­‰å¾…æ‰€æœ‰ goroutine å®Œæˆï¼ˆä½¿ç”¨ WaitGroupï¼‰
> - è®¾ç½®è¶…æ—¶æœºåˆ¶ï¼Œé¿å…æ— é™ç­‰å¾…
> - è®°å½•å…³é—­è¿‡ç¨‹çš„æ—¥å¿—

ç¤ºä¾‹ï¼š
```go
func main() {
    // åˆ›å»ºä¸€ä¸ªç”¨äºæ¥æ”¶ç³»ç»Ÿä¿¡å·çš„é€šé“
    sigs := make(chan os.Signal, 1)
    signal.Notify(sigs, syscall.SIGINT, syscall.SIGTERM)
    
    // åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„ä¸Šä¸‹æ–‡
    ctx, cancel := context.WithCancel(context.Background())
    
    // å¯åŠ¨æœåŠ¡
    server := startServer(ctx)
    
    // ç­‰å¾…ä¿¡å·
    <-sigs
    fmt.Println("æ”¶åˆ°å…³é—­ä¿¡å·ï¼Œå¼€å§‹ä¼˜é›…å…³é—­...")
    
    // å–æ¶ˆä¸Šä¸‹æ–‡
    cancel()
    
    // è®¾ç½®å…³é—­è¶…æ—¶
    shutdownCtx, shutdownCancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer shutdownCancel()
    
    // ç­‰å¾…æœåŠ¡å…³é—­
    if err := server.Shutdown(shutdownCtx); err != nil {
        fmt.Printf("æœåŠ¡å…³é—­å‡ºé”™: %v\n", err)
    }
    
    fmt.Println("æœåŠ¡å·²å®‰å…¨å…³é—­")
}
```

---

### Q17: Go ä¸­çš„ context åŒ…çš„ä¸»è¦ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä¼ é€’è¯·æ±‚èŒƒå›´çš„å€¼ï¼ˆå¦‚è¯·æ±‚ IDã€ç”¨æˆ·ä¿¡æ¯ï¼‰
> - æ§åˆ¶ goroutine çš„å–æ¶ˆä¿¡å·
> - è®¾ç½®æˆªæ­¢æ—¶é—´å’Œè¶…æ—¶
> - è·¨ API è¾¹ç•Œä¼ é€’ä¿¡å·
> - åœ¨å¤šä¸ª goroutine ä¹‹é—´åè°ƒå·¥ä½œ
> - é˜²æ­¢ goroutine æ³„æ¼

ç¤ºä¾‹ï¼š
```go
func handleRequest(w http.ResponseWriter, r *http.Request) {
    // åˆ›å»ºå¸¦è¶…æ—¶çš„ä¸Šä¸‹æ–‡
    ctx, cancel := context.WithTimeout(r.Context(), 5*time.Second)
    defer cancel()
    
    // æ·»åŠ å€¼åˆ°ä¸Šä¸‹æ–‡
    ctx = context.WithValue(ctx, "requestID", uuid.New().String())
    
    // è°ƒç”¨å¤„ç†å‡½æ•°
    result, err := processRequest(ctx)
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
        return
    }
    
    fmt.Fprintf(w, "ç»“æœ: %v", result)
}

func processRequest(ctx context.Context) (string, error) {
    // è·å–ä¸Šä¸‹æ–‡ä¸­çš„å€¼
    requestID := ctx.Value("requestID").(string)
    
    // åˆ›å»ºä¸€ä¸ªé€šé“æ¥æ”¶ç»“æœ
    resultCh := make(chan string, 1)
    errCh := make(chan error, 1)
    
    go func() {
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        time.Sleep(2 * time.Second)
        resultCh <- "å¤„ç†å®Œæˆ: " + requestID
    }()
    
    // ç­‰å¾…ç»“æœæˆ–ä¸Šä¸‹æ–‡å–æ¶ˆ
    select {
    case result := <-resultCh:
        return result, nil
    case err := <-errCh:
        return "", err
    case <-ctx.Done():
        return "", ctx.Err()
    }
}
```

---

### Q18: Go ä¸­å¦‚ä½•å¤„ç† JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ `encoding/json` åŒ…çš„ `Marshal` å’Œ `Unmarshal` å‡½æ•°
> - ä½¿ç”¨ç»“æ„ä½“æ ‡ç­¾ï¼ˆtagsï¼‰æ§åˆ¶å­—æ®µåå’Œé€‰é¡¹
> - å¤„ç†è‡ªå®šä¹‰ç±»å‹çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–
> - ä½¿ç”¨ `json.Decoder` å’Œ `json.Encoder` è¿›è¡Œæµå¼å¤„ç†
> - å¤„ç†å¤§å‹ JSON æ–‡ä»¶æ—¶é¿å…ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜
> - ä½¿ç”¨ `omitempty` å¿½ç•¥é›¶å€¼å­—æ®µ

ç¤ºä¾‹ï¼š
```go
type User struct {
    ID        int       `json:"id"`
    Name      string    `json:"name"`
    Email     string    `json:"email,omitempty"`
    CreatedAt time.Time `json:"created_at"`
    UpdatedAt time.Time `json:"-"` // ä¸åºåˆ—åŒ–æ­¤å­—æ®µ
}

// åºåˆ—åŒ–
user := User{ID: 1, Name: "å¼ ä¸‰", Email: "zhangsan@example.com"}
data, err := json.Marshal(user)
if err != nil {
    log.Fatal(err)
}

// ååºåˆ—åŒ–
var newUser User
if err := json.Unmarshal(data, &newUser); err != nil {
    log.Fatal(err)
}

// æµå¼å¤„ç†
func decodeUsers(r io.Reader) ([]User, error) {
    decoder := json.NewDecoder(r)
    var users []User
    err := decoder.Decode(&users)
    return users, err
}
```

---

### Q19: Go ä¸­çš„ select è¯­å¥å¦‚ä½•å·¥ä½œï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - select ç”¨äºåœ¨å¤šä¸ªé€šé“æ“ä½œä¸­è¿›è¡Œé€‰æ‹©
> - å¦‚æœå¤šä¸ª case åŒæ—¶å°±ç»ªï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œ
> - å¦‚æœæ²¡æœ‰ case å°±ç»ªä¸”æœ‰ defaultï¼Œåˆ™æ‰§è¡Œ default
> - å¦‚æœæ²¡æœ‰ case å°±ç»ªä¸”æ²¡æœ‰ defaultï¼Œåˆ™é˜»å¡ç›´åˆ°æœ‰ case å°±ç»ª
> - ç©ºçš„ select è¯­å¥ä¼šæ°¸è¿œé˜»å¡
> - select å¯ä»¥ä¸ for å¾ªç¯ç»“åˆå®ç°å¤šè·¯å¤ç”¨

ç¤ºä¾‹ï¼š
```go
func selectDemo() {
    ch1 := make(chan string)
    ch2 := make(chan string)
    
    go func() {
        time.Sleep(1 * time.Second)
        ch1 <- "æ¥è‡ªé€šé“ 1 çš„æ¶ˆæ¯"
    }()
    
    go func() {
        time.Sleep(2 * time.Second)
        ch2 <- "æ¥è‡ªé€šé“ 2 çš„æ¶ˆæ¯"
    }()
    
    // ç­‰å¾…ä¸¤ä¸ªé€šé“éƒ½æœ‰æ¶ˆæ¯
    for i := 0; i < 2; i++ {
        select {
        case msg1 := <-ch1:
            fmt.Println(msg1)
        case msg2 := <-ch2:
            fmt.Println(msg2)
        case <-time.After(3 * time.Second):
            fmt.Println("è¶…æ—¶")
            return
        }
    }
}
```

---

### Q20: Go ä¸­å¦‚ä½•å®ç°å¹¶å‘æ§åˆ¶ï¼Ÿ

> ç­”æ¡ˆè¦ç‚¹ï¼š
> - ä½¿ç”¨ `sync.WaitGroup` ç­‰å¾…ä¸€ç»„ goroutine å®Œæˆ
> - ä½¿ç”¨ `sync.Mutex` å’Œ `sync.RWMutex` ä¿æŠ¤å…±äº«èµ„æº
> - ä½¿ç”¨ channel è¿›è¡Œé€šä¿¡å’ŒåŒæ­¥
> - ä½¿ç”¨ `context` åŒ…æ§åˆ¶å–æ¶ˆå’Œè¶…æ—¶
> - ä½¿ç”¨ `errgroup.Group` å¤„ç†å¹¶å‘é”™è¯¯
> - ä½¿ç”¨ä¿¡å·é‡æ¨¡å¼é™åˆ¶å¹¶å‘æ•°é‡
> - ä½¿ç”¨ `sync.Once` ç¡®ä¿ä»£ç åªæ‰§è¡Œä¸€æ¬¡

ç¤ºä¾‹ï¼š
```go
// ä½¿ç”¨ channel é™åˆ¶å¹¶å‘æ•°
func limitConcurrency(urls []string, concurrency int) {
    semaphore := make(chan struct{}, concurrency)
    var wg sync.WaitGroup
    
    for _, url := range urls {
        wg.Add(1)
        go func(url string) {
            defer wg.Done()
            
            semaphore <- struct{}{} // è·å–ä»¤ç‰Œ
            defer func() { <-semaphore }() // é‡Šæ”¾ä»¤ç‰Œ
            
            // å¤„ç† URL
            fmt.Println("å¤„ç†:", url)
            time.Sleep(1 * time.Second)
        }(url)
    }
    
    wg.Wait()
}
```

---



# ğŸ“ å…­ã€æ€»ç»“ä¸å­¦ä¹ è·¯å¾„å»ºè®®

å¦‚æœä½ æ­£åœ¨å‡†å¤‡ Go å·¥ç¨‹å¸ˆå²—ä½çš„ä¸­é«˜çº§æŠ€æœ¯é¢è¯•ï¼Œå»ºè®®ä½ æŒ‰ç…§ä»¥ä¸‹è·¯å¾„å¤ä¹ ï¼š

1. **åŸºç¡€è¯­æ³•**ï¼šç†è§£åº•å±‚å®ç°ã€å†…å­˜æ¨¡å‹ã€ç±»å‹ç³»ç»Ÿ
2. **å¹¶å‘ç¼–ç¨‹**ï¼šgoroutineã€channelã€contextã€WaitGroupã€errgroupã€Mutexã€Cond
3. **æ€§èƒ½ä¼˜åŒ–**ï¼špprofã€sync.Poolã€é€ƒé€¸åˆ†æã€reflect.DeepEqualã€strings.Builder
4. **æ ‡å‡†åº“**ï¼šnet/httpã€encoding/jsonã€database/sqlã€osã€ioã€bufioã€regexp
5. **å·¥ç¨‹å®è·µ**ï¼šä¾èµ–ç®¡ç†ï¼ˆgo modï¼‰ã€æµ‹è¯•ï¼ˆtestingï¼‰ã€CI/CDã€å¾®æœåŠ¡æ¶æ„
6. **é¡¹ç›®ç»éªŒ**ï¼šå‡†å¤‡ 1~2 ä¸ªçœŸå®é¡¹ç›®æ¡ˆä¾‹ï¼Œçªå‡ºè®¾è®¡ã€æ€§èƒ½ã€ç¨³å®šæ€§ã€å¯è§‚æµ‹æ€§

---

å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ çš„ç›®æ ‡å…¬å¸ï¼ˆå¦‚è…¾è®¯ã€é˜¿é‡Œã€å­—èŠ‚ã€ç¾å›¢ç­‰ï¼‰ï¼Œæˆ‘å¯ä»¥å¸®ä½ å®šåˆ¶ä¸€ä»½ **â€œé’ˆå¯¹æŸå…¬å¸é«˜é¢‘çœŸé¢˜ + é¡¹ç›®åŒ¹é…â€çš„é¢è¯•å‡†å¤‡è®¡åˆ’**ï¼ŒåŒ…æ‹¬æ¨¡æ‹Ÿé¢è°ˆã€ç™½æ¿ç¼–ç ã€æ¶æ„è®¾è®¡ç­‰å†…å®¹ã€‚

ç»§ç»­æé—®å§ï¼æˆ‘ä»¬ä¸€èµ·æ”»å…‹ Go æŠ€æœ¯é¢è¯•éš¾ç‚¹ğŸ’ª